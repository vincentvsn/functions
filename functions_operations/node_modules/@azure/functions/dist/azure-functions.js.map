{"version":3,"file":"azure-functions.js","mappings":";;;;;;;;;;;AAAA,sDAAsD;AACtD,kCAAkC;;;AAYlC,uDAAkC;AAClC,+HAIwC;AACxC,mHAAgF;AAEhF,qFAAyC;AACzC,wFAA2C;AAG3C,SAAgB,sBAAsB,CAClC,IAAkB,EAClB,OAA6B,EAC7B,eAAgC,EAChC,WAAyB;IAEzB,MAAM,OAAO,GAAG,IAAI,iBAAiB,CAAC,IAAI,EAAE,OAAO,EAAE,eAAe,EAAE,WAAW,CAAC,CAAC;IAEnF,MAAM,QAAQ,GAAoB,EAAE,CAAC;IACrC,MAAM,MAAM,GAAU,EAAE,CAAC;IACzB,IAAI,SAA8B,CAAC;IACnC,KAAK,MAAM,OAAO,IAA2B,OAAO,CAAC,SAAS,EAAE;QAC5D,IAAI,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,EAAE;YAC9B,IAAI,KAAK,CAAC;YACV,IAAI,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE;gBACnC,KAAK,GAAG,SAAS,GAAG,IAAI,iBAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACtD;iBAAM;gBACH,4GAA4G;gBAC5G,IAAI,IAAI,CAAC,mBAAmB,EAAE,KAAK,OAAO,CAAC,IAAI,EAAE;oBAC7C,uDAAuD;oBACvD,KAAK,GAAG,8CAAsB,EAAC,OAAO,CAAC,CAAC,MAAM,CAAC,CAAC;iBACnD;qBAAM;oBACH,KAAK,GAAG,iCAAa,EAAC,OAAO,CAAC,IAAI,CAAC,CAAC;iBACvC;aACJ;YACD,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;YAC/B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACtB;KACJ;IAED,OAAO,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC5B,IAAI,SAAS,EAAE;QACX,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;QACxB,OAAO,CAAC,GAAG,GAAG,IAAI,mBAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACzC,0FAA0F;QAC1F,OAAO,CAAC,WAAW,CAAC,GAAG,GAAG;YACtB,UAAU,EAAE,IAAI,CAAC,IAAI;YACrB,MAAM,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;YAChC,QAAQ,EAAE,aAAI,GAAE;SACnB,CAAC;QACF,oEAAoE;QACpE,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,EAAE;YAC5B,OAAO,CAAC,WAAW,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;SAClE;QACD,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,OAAO,EAAE;YAC9B,OAAO,CAAC,WAAW,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,OAAO,CAAC,CAAC;SACtE;KACJ;IACD,OAAO;QACH,OAAO,EAAW,OAAO;QACzB,MAAM,EAAE,MAAM;KACjB,CAAC;AACN,CAAC;AApDD,wDAoDC;AAED,MAAM,iBAAiB;IAYnB,YACI,IAAkB,EAClB,OAA6B,EAC7B,eAAgC,EAChC,WAAyB;QAEzB,IAAI,CAAC,YAAY,GAAW,OAAO,CAAC,YAAY,CAAC;QACjD,IAAI,CAAC,YAAY,GAAG,uCAAmB,EAAC,OAAO,CAAC,YAAY,CAAC,CAAC;QAC9D,MAAM,gBAAgB,GAAqB;YACvC,YAAY,EAAE,IAAI,CAAC,YAAY;YAC/B,YAAY,EAAE,IAAI,CAAC,IAAI;YACvB,iBAAiB,EAAE,IAAI,CAAC,SAAS;YACjC,YAAY,EAAE,OAAO,CAAC,YAAY;SACrC,CAAC;QACF,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QACzC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QAEnB,kDAAkD;QAClD,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,IAAW,EAAE,EAAE,CAAC,eAAe,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC,EAAE;YAClF,KAAK,EAAE,CAAC,GAAG,IAAW,EAAE,EAAE,CAAC,eAAe,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC;YAC5D,IAAI,EAAE,CAAC,GAAG,IAAW,EAAE,EAAE,CAAC,eAAe,CAAC,SAAS,EAAE,GAAG,IAAI,CAAC;YAC7D,IAAI,EAAE,CAAC,GAAG,IAAW,EAAE,EAAE,CAAC,eAAe,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC;YACjE,OAAO,EAAE,CAAC,GAAG,IAAW,EAAE,EAAE,CAAC,eAAe,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC;SACjE,CAAC,CAAC;QAEH,IAAI,CAAC,WAAW,GAAG,gDAAwB,EAAC,OAAO,CAAC,CAAC;QACrD,IAAI,CAAC,kBAAkB,GAAG,6CAAqB,EAAC,IAAI,CAAC,CAAC;QAEtD,IAAI,CAAC,IAAI,GAAG,CAAC,GAAa,EAAE,MAAY,EAAE,EAAE;YACxC,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC;QAC1C,CAAC,CAAC;IACN,CAAC;CACJ;;;;;;;;;;;;AC3HD,sDAAsD;AACtD,kCAAkC;;;AAGlC,mHAAyD;AACzD,+HAA2D;AAE3D,MAAM,gBAAgB,GAAG,SAAS,CAAC;AAEnC,MAAa,YAAY;IAYrB,YAAY,QAA6B;QACrC,IAAI,CAAC,IAAI,GAAW,QAAQ,CAAC,IAAI,CAAC;QAClC,IAAI,CAAC,SAAS,GAAW,QAAQ,CAAC,SAAS,CAAC;QAC5C,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;QACzB,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;QACzB,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;QAE5B,IAAI,QAAQ,CAAC,QAAQ,EAAE;YACnB,MAAM,QAAQ,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC;YAErD,qEAAqE;YACrE,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;iBAChB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,SAAS,KAAK,IAAI,CAAC;iBACnD,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACd,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;gBACjC,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,MAAM,EAAE;oBACvC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;oBAC3B,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,SAAS,EAAE,6BAAS,EAAE,CAAC,CAAC;iBACvF;qBAAM;oBACH,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,SAAS,EAAE,2BAAW,EAAE,CAAC,CAAC;iBACzF;YACL,CAAC,CAAC,CAAC;YAEP,IAAI,CAAC,cAAc;gBACf,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE;oBAClC,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;oBACjC,OAAO,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,aAAa,CAAC;gBACxD,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;SACrB;IACL,CAAC;IAED;;OAEG;IACH,gBAAgB;QACZ,OAAO,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,CAAC;IACjD,CAAC;IAED,mBAAmB;QACf,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;YAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;YACtC,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,cAAc,EAAE;gBAC/C,OAAO,IAAI,CAAC;aACf;SACJ;QACD,OAAO;IACX,CAAC;CACJ;AA5DD,oCA4DC;;;;;;;;;;;;ACrED,sDAAsD;AACtD,kCAAkC;;;;;;;;;;;;;;;;;;;;;;;;AAYlC,uDAA8B;AAC9B,2EAAmD;AACnD,mHAAyD;AACzD,wEAAmC;AACnC,0FAA8C;AAC9C,iEAAwC;AAExC,MAAM,sBAAsB,GAAG,iDAAiD,CAAC;AAEjF,MAAa,eAAe;IAOxB,YAAY,OAA8B;;QAN1C,uCAA6B,IAAI,YAAY,EAAE,EAAC;QAChD,kCAAU,KAAK,EAAC;QAChB,2CAAmB,KAAK,EAAC;QACzB,2CAAgC;QAChC,4CAAwB;QAGpB,2BAAI,4BAAY,OAAO,OAAC;QACxB,2BAAI,6BAAa,IAAI,2BAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAC;IACxD,CAAC;IAEK,YAAY;;YACd,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,oCAAsB,EAC9C,2BAAI,iCAAU,EACd,2BAAI,gCAAS,CAAC,OAAO,EACrB,CAAC,KAAkB,EAAE,GAAG,IAAW,EAAE,EAAE,CAAC,2BAAI,4DAAS,MAAb,IAAI,EAAU,KAAK,EAAE,GAAG,IAAI,CAAC,EACrE,2BAAI,oCAAa,CACpB,CAAC;YACF,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC;QAC/B,CAAC;KAAA;IAEK,cAAc,CAAC,OAAgB,EAAE,MAAiB,EAAE,gBAA+B;;YACrF,MAAM,cAAc,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;gBACnD,2BAAI,oCAAa,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,GAAa,EAAE,MAAgB,EAAE,EAAE;oBAC7D,2BAAI,2DAAQ,MAAZ,IAAI,EAAS,OAAO,CAAC,sBAAsB,CAAC,CAAC;oBAC7C,IAAI,oBAAO,EAAC,GAAG,CAAC,EAAE;wBACd,MAAM,CAAC,GAAG,CAAC,CAAC;qBACf;yBAAM;wBACH,OAAO,CAAC,MAAM,CAAC,CAAC;qBACnB;gBACL,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;YAEH,IAAI;gBACA,IAAI,SAAS,GAAG,gBAAgB,CAAC,OAAO,EAAE,GAAG,MAAM,CAAC,CAAC;gBACrD,2BAAI,oCAAoB,CAAC,CAAC,SAAS,IAAI,OAAO,SAAS,CAAC,IAAI,KAAK,UAAU,OAAC;gBAC5E,IAAI,UAAwB,CAAC;gBAC7B,IAAI,2BAAI,wCAAiB,EAAE;oBACvB,SAAS,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE;wBAC9C,2BAAI,2DAAQ,MAAZ,IAAI,EAAS,OAAO,CAAC,sBAAsB,CAAC,CAAC;wBAC7C,OAAO,CAAC,CAAC;oBACb,CAAC,CAAC,CAAC;oBACH,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC,CAAC;iBAC1D;qBAAM;oBACH,UAAU,GAAG,cAAc,CAAC;iBAC/B;gBAED,OAAO,MAAM,UAAU,CAAC;aAC3B;oBAAS;gBACN,2BAAI,2BAAW,IAAI,OAAC;aACvB;QACL,CAAC;KAAA;IAEK,WAAW,CAAC,OAAgB,EAAE,MAAe;;;YAC/C,MAAM,QAAQ,GAA0B,EAAE,YAAY,EAAE,2BAAI,gCAAS,CAAC,YAAY,EAAE,CAAC;YACrF,QAAQ,CAAC,UAAU,GAAG,EAAE,CAAC;YACzB,MAAM,IAAI,GAAG,2BAAI,iCAAU,CAAC;YAE5B,wGAAwG;YACxG,IAAI,IAAI,CAAC,cAAc,IAAI,OAAO,CAAC,GAAG,IAAI,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,SAAS,EAAE;gBAC3F,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC;aACvD;YAED,4EAA4E;YAC5E,yEAAyE;YACzE,6DAA6D;YAC7D,wEAAwE;YACxE,yBAAyB;YACzB,MAAM,gBAAgB,GAAG,iBAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,IAAI,0CAAE,IAAI,KAAI,iBAAiB,CAAC;YAEzE,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC9C,yCAAyC;YACzC,IAAI,MAAM,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,IAAI,CAAC,EAAE;gBAChD,kEAAkE;gBAClE,IAAI,aAAa,EAAE;oBACf,QAAQ,CAAC,WAAW,GAAG,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;oBACvD,iEAAiE;iBACpE;qBAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,EAAE;oBACnC,QAAQ,CAAC,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC;yBACjD,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,SAAS,CAAC;yBAC1C,GAAG,CACA,CAAC,GAAG,EAAE,EAAE,CACJ,CAAqB;wBACjB,IAAI,EAAE,GAAG;wBACT,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;qBACxD,EACR,CAAC;iBACT;gBACD,uEAAuE;gBACvE,gCAAgC;gBAChC,IAAI,CAAC,QAAQ,CAAC,WAAW,IAAI,QAAQ,CAAC,UAAU,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;oBAClF,QAAQ,CAAC,WAAW,GAAG,+BAAW,EAAC,MAAM,CAAC,CAAC;iBAC9C;aACJ;YACD,oCAAoC;YACpC,IAAI,OAAO,CAAC,QAAQ,EAAE;gBAClB,QAAQ,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC,MAAM,CAC5C,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC;oBAC5B,+DAA+D;qBAC9D,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE;oBACZ,MAAM,iBAAiB,GAAY,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,SAAS,CAAC;oBACvE,MAAM,cAAc,GAAG,CAAC,CAAC,MAAM,CAAC;oBAChC,MAAM,gBAAgB,GAAG,CAAC,CAAC,aAAa,CAAC;oBACzC,MAAM,eAAe,GACjB,cAAc;wBACd,CAAC,gBAAgB;wBACjB,OAAO,MAAM,KAAK,QAAQ;wBAC1B,MAAM,CAAC,GAAG,CAAC,KAAK,SAAS,CAAC;oBAC9B,OAAO,iBAAiB,IAAI,CAAC,eAAe,CAAC;gBACjD,CAAC,CAAC;qBACD,GAAG,CACA,CAAC,GAAG,EAAE,EAAE,CACJ,CAAqB;oBACjB,IAAI,EAAE,GAAG;oBACT,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;iBAClE,EACR,CACR,CAAC;aACL;YACD,OAAO,QAAQ,CAAC;;KACnB;CAkCJ;AA3JD,0CA2JC;+TAhCQ,KAAkB,EAAE,WAA2B,EAAE,GAAG,IAAW;IAChE,2BAAI,gCAAS,CAAC,GAAG,CAAC,KAAK,EAAE,WAAW,EAAE,aAAM,CAAC,KAAK,CAAC,IAAI,EAAgB,IAAI,CAAC,CAAC,CAAC;AAClF,CAAC,mEAEU,KAAkB,EAAE,GAAG,IAAW;IACzC,2BAAI,wDAAK,MAAT,IAAI,EAAM,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,CAAC;AACxC,CAAC,+DAEQ,KAAkB,EAAE,GAAG,IAAW;IACvC,IAAI,2BAAI,+BAAQ,IAAI,2BAAI,gCAAS,CAAC,KAAK,KAAK,qBAAqB,EAAE;QAC/D,IAAI,WAAW,GACX,wNAAwN,CAAC;QAC7N,WAAW,IAAI,kBAAkB,2BAAI,iCAAU,CAAC,IAAI,oBAAoB,2BAAI,gCAAS,CAAC,YAAY,IAAI,CAAC;QACvG,WAAW,IAAI,eAAe,sBAAsB,EAAE,CAAC;QACvD,2BAAI,8DAAW,MAAf,IAAI,EAAY,SAAS,EAAE,WAAW,CAAC,CAAC;KAC3C;IACD,2BAAI,wDAAK,MAAT,IAAI,EAAM,KAAK,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC;AACtC,CAAC,6DAEO,sBAAsB,GAAG,KAAK;IAClC,IAAI,2BAAI,+BAAQ,EAAE;QACd,IAAI,2BAAI,wCAAiB,IAAI,sBAAsB,EAAE;YACjD,OAAO;SACV;QAED,MAAM,OAAO,GAAG,2BAAI,wCAAiB;YACjC,CAAC,CAAC,wGAAwG,sBAAsB,EAAE;YAClI,CAAC,CAAC,iGAAiG,CAAC;QACxG,2BAAI,8DAAW,MAAf,IAAI,EAAY,OAAO,EAAE,OAAO,CAAC,CAAC;KACrC;IACD,2BAAI,2BAAW,IAAI,OAAC;AACxB,CAAC;;;;;;;;;;;;AChLL,sDAAsD;AACtD,kCAAkC;;;AAErB,eAAO,GAAG,OAAO,CAAC;AAE/B,IAAY,UAGX;AAHD,WAAY,UAAU;IAClB,0CAA4B;IAC5B,wDAA0C;AAC9C,CAAC,EAHW,UAAU,GAAV,kBAAU,KAAV,kBAAU,QAGrB;AAED,IAAY,SAMX;AAND,WAAY,SAAS;IACjB,kDAAqC;IACrC,2CAA8B;IAC9B,iEAAoD;IACpD,qDAAwC;IACxC,sCAAyB;AAC7B,CAAC,EANW,SAAS,GAAT,iBAAS,KAAT,iBAAS,QAMpB;;;;;;;;;;;;AChBD,sDAAsD;AACtD,kCAAkC;;;AAKlC,wGAAgD;AAEhD,SAAgB,qBAAqB,CAAC,IAAkB;IACpD,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC/B,IAAI,CAAC,QAAQ,EAAE;QACX,OAAO,EAAE,CAAC;KACb;IAED,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE;QACtC,OAAO;YACH,IAAI,EAAE,IAAI;YACV,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,EAAE;YAC/B,SAAS,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,SAAS,IAAI,SAAS;SACnD,CAAC;IACN,CAAC,CAAC,CAAC;AACP,CAAC;AAbD,sDAaC;AAED,SAAgB,wBAAwB,CAAC,OAA6B;IAClE,MAAM,WAAW,GAAuB;QACpC,YAAY,EAAU,OAAO,CAAC,YAAY;KAC7C,CAAC;IAEF,8DAA8D;IAC9D,IAAI,OAAO,CAAC,eAAe,EAAE;QACzB,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,sBAAsB,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC;KAC/E;IACD,OAAO,WAAW,CAAC;AACvB,CAAC;AAVD,4DAUC;AAED,oDAAoD;AACpD,SAAgB,sBAAsB,CAAC,GAAQ;IAC3C,MAAM,MAAM,GAAG,EAAE,CAAC;IAClB,KAAK,MAAM,GAAG,IAAI,GAAG,EAAE;QACnB,MAAM,aAAa,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,iBAAiB,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACvE,IAAI;YACA,gFAAgF;YAChF,uBAAuB;YACvB,+BAA+B;YAC/B,0DAA0D;YAC1D,MAAM,iBAAiB,GAAG,iCAAa,EAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAClD,MAAM,KAAK,GAAG,iBAAiB,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC;YAC7E,iHAAiH;YACjH,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,IAAI,KAAK,CAAC,IAAI,IAAI,SAAS,EAAE;gBACxF,MAAM,CAAC,aAAa,CAAC,GAAG,sBAAsB,CAAC,KAAK,CAAC,CAAC;aACzD;iBAAM;gBACH,MAAM,CAAC,aAAa,CAAC,GAAG,KAAK,CAAC;aACjC;SACJ;QAAC,WAAM;YACJ,iFAAiF;YACjF,MAAM,CAAC,aAAa,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;SACpC;KACJ;IACD,OAAO,MAAM,CAAC;AAClB,CAAC;AAvBD,wDAuBC;;;;;;;;;;;;AC3DD,sDAAsD;AACtD,kCAAkC;;;AAWlC,uDAA8B;AAC9B,yEAA8C;AAE9C;;;;;GAKG;AACH,SAAgB,aAAa,CAAC,SAA+B,EAAE,mBAAmB,GAAG,IAAI;IACrF,SAAS,GAAG,SAAS,IAAI,EAAE,CAAC;IAC5B,IAAI,GAAG,GAAG,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,IAAI,CAAC;IAC7C,IAAI,GAAG,KAAK,SAAS,EAAE;QACnB,IAAI,mBAAmB,EAAE;YACrB,IAAI;gBACA,IAAI,GAAG,IAAI,IAAI,EAAE;oBACb,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;iBACzB;aACJ;YAAC,OAAO,GAAG,EAAE,GAAE;SACnB;QACD,OAAO,GAAG,CAAC;KACd;SAAM,IAAI,SAAS,CAAC,KAAK,EAAE;QACxB,OAAO,MAAM,CAAC,IAAI,CAAS,SAAS,CAAC,KAAK,CAAC,CAAC;KAC/C;SAAM,IAAI,SAAS,CAAC,eAAe,IAAI,SAAS,CAAC,eAAe,CAAC,KAAK,EAAE;QACrE,MAAM,cAAc,GAAG,SAAS,CAAC,eAAe,CAAC,KAAK,CAAC;QACvD,OAAO,cAAc,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,CAAS,OAAO,CAAC,CAAC,CAAC;KACxE;SAAM,IAAI,SAAS,CAAC,gBAAgB,IAAI,SAAS,CAAC,gBAAgB,CAAC,MAAM,EAAE;QACxE,OAAO,SAAS,CAAC,gBAAgB,CAAC,MAAM,CAAC;KAC5C;SAAM,IAAI,SAAS,CAAC,gBAAgB,IAAI,SAAS,CAAC,gBAAgB,CAAC,MAAM,EAAE;QACxE,OAAO,SAAS,CAAC,gBAAgB,CAAC,MAAM,CAAC;KAC5C;SAAM,IAAI,SAAS,CAAC,gBAAgB,IAAI,SAAS,CAAC,gBAAgB,CAAC,MAAM,EAAE;QACxE,MAAM,cAAc,GAAG,SAAS,CAAC,gBAAgB,CAAC,MAAM,CAAC;QACzD,OAAO,cAAc,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,iBAAM,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;KAC5F;AACL,CAAC;AAzBD,sCAyBC;AAED;;;GAGG;AACH,SAAgB,mBAAmB,CAAC,YAAgD;IAChF,IAAI,YAAY,EAAE;QACd,OAAqB;YACjB,WAAW,EAAE,YAAY,CAAC,WAAW;YACrC,UAAU,EAAE,YAAY,CAAC,UAAU;YACnC,UAAU,EAAE,YAAY,CAAC,UAAU;SACtC,CAAC;KACL;IAED,OAAqB,EAAE,CAAC;AAC5B,CAAC;AAVD,kDAUC;AAED;;;;GAIG;AACH,SAAgB,WAAW,CAAC,WAAW;IACnC,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;QACjC,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC;KAClC;SAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE;QACrC,OAAO,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC;KACjC;SAAM,IAAI,WAAW,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE;QACxC,MAAM,KAAK,GAAG,IAAI,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,WAAW,CAAC,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC,CAAC;QACjG,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;KAC3B;SAAM,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;QACxC,IAAI,MAAM,CAAC,SAAS,CAAC,WAAW,CAAC,EAAE;YAC/B,OAAO,EAAE,GAAG,EAAE,WAAW,EAAE,CAAC;SAC/B;aAAM;YACH,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC;SAClC;KACJ;SAAM;QACH,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,EAAE,CAAC;KAChD;AACL,CAAC;AAjBD,kCAiBC;AAED;;;;;GAKG;AACH,SAAgB,cAAc,CAAC,QAA6B,EAAE,YAAoB;IAC9E,IAAI,OAAO,QAAQ,KAAK,SAAS,EAAE;QAC/B,OAAwB;YACpB,KAAK,EAAE,QAAQ;SAClB,CAAC;KACL;IAED,IAAI,QAAQ,IAAI,IAAI,EAAE;QAClB,MAAM,IAAI,0BAAiB,CACvB,+CAA+C,OAAO,QAAQ,kCAAkC,YAAY,IAAI,CACnH,CAAC;KACL;IAED,OAAO,SAAS,CAAC;AACrB,CAAC;AAdD,wCAcC;AAED;;;;;GAKG;AACH,SAAgB,gBAAgB,CAC5B,QAAqC,EACrC,YAAoB;IAEpB,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;QAC9B,OAA0B;YACtB,KAAK,EAAE,QAAQ;SAClB,CAAC;KACL;SAAM,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;QACrC,IAAI,CAAC,KAAK,CAAM,QAAQ,CAAC,EAAE;YACvB,MAAM,YAAY,GAAG,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC1C,OAA0B;gBACtB,KAAK,EAAE,YAAY;aACtB,CAAC;SACL;KACJ;IAED,IAAI,QAAQ,IAAI,IAAI,EAAE;QAClB,MAAM,IAAI,0BAAiB,CACvB,8CAA8C,OAAO,QAAQ,kCAAkC,YAAY,IAAI,CAClH,CAAC;KACL;IAED,OAAO,SAAS,CAAC;AACrB,CAAC;AAxBD,4CAwBC;AAED;;;;;GAKG;AACH,SAAgB,WAAW,CAAC,QAA4B,EAAE,YAAoB;IAC1E,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;QAC9B,OAAO,QAAQ,CAAC;KACnB;IAED,IAAI,QAAQ,IAAI,IAAI,EAAE;QAClB,MAAM,IAAI,0BAAiB,CACvB,8CAA8C,OAAO,QAAQ,kCAAkC,YAAY,IAAI,CAClH,CAAC;KACL;IAED,OAAO,EAAE,CAAC;AACd,CAAC;AAZD,kCAYC;AAED;;;;;GAKG;AACH,SAAgB,gBAAgB,CAAC,QAA4B,EAAE,YAAoB;IAC/E,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;QAC9B,OAA0B;YACtB,KAAK,EAAE,QAAQ;SAClB,CAAC;KACL;IAED,IAAI,QAAQ,IAAI,IAAI,EAAE;QAClB,MAAM,IAAI,0BAAiB,CACvB,8CAA8C,OAAO,QAAQ,kCAAkC,YAAY,IAAI,CAClH,CAAC;KACL;IAED,OAAO,SAAS,CAAC;AACrB,CAAC;AAdD,4CAcC;AAED;;;;;GAKG;AACH,SAAgB,mBAAmB,CAC/B,QAAmC,EACnC,YAAoB;IAEpB,IAAI,QAAQ,IAAI,IAAI,EAAE;QAClB,IAAI;YACA,MAAM,kBAAkB,GAAG,OAAO,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;YAExF,IAAI,kBAAkB,IAAI,kBAAkB,IAAI,CAAC,EAAE;gBAC/C,OAAO;oBACH,KAAK,EAAE;wBACH,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,kBAAkB,GAAG,IAAI,CAAC;qBACjD;iBACJ,CAAC;aACL;SACJ;QAAC,WAAM;YACJ,MAAM,IAAI,0BAAiB,CACvB,yDAAyD,OAAO,QAAQ,6BAA6B,YAAY,IAAI,CACxH,CAAC;SACL;KACJ;IACD,OAAO,SAAS,CAAC;AACrB,CAAC;AAtBD,kDAsBC;;;;;;;;;;;;ACpND,sDAAsD;AACtD,kCAAkC;;;AAWlC,yEAA8C;AAC9C,wGAQyB;AAEzB;;;;;GAKG;AACH,SAAgB,eAAe,CAAC,IAAqC;IACjE,IAAI,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;QACpB,OAAgB,IAAI,CAAC,KAAM,CAAC,QAAQ,EAAE,CAAC;KAC1C;SAAM;QACH,OAAO,iCAAa,EAAC,IAAI,EAAE,KAAK,CAAC,CAAC;KACrC;AACL,CAAC;AAND,0CAMC;AAED,SAAgB,mBAAmB,CAC/B,eAAsE,EACtE,eAAgD;IAEhD,IAAI,SAAS,GAAG,EAAE,CAAC;IACnB,IAAI,eAAe,IAAI,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;QAC5D,KAAK,MAAM,GAAG,IAAI,eAAe,EAAE;YAC/B,SAAS,CAAC,GAAG,CAAC,GAAG,eAAe,CAAC,GAAG,CAAC,CAAC,KAAK,IAAI,EAAE,CAAC;SACrD;KACJ;SAAM,IAAI,eAAe,IAAI,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;QACnE,SAAS,GAAiB,eAAe,CAAC;KAC7C;IACD,OAAO,SAAS,CAAC;AACrB,CAAC;AAbD,kDAaC;AAED;;;;GAIG;AACH,SAAgB,SAAS,CAAC,IAAa;IACnC,6CAA6C;IAC7C,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QACjD,MAAM,IAAI,0BAAiB,CACvB,6KAA6K,CAChL,CAAC;KACL;IAED,MAAM,YAAY,GAAiB,IAAI,IAAI,EAAE,CAAC;IAC9C,IAAI,MAAM,GAAG,YAAY,CAAC,UAAU,CAAC;IACrC,IAAI,OAAO,YAAY,CAAC,MAAM,KAAK,UAAU,EAAE;QAC3C,MAAM,KAAN,MAAM,GAAK,YAAY,CAAC,MAAM,EAAC;KAClC;IACD,MAAM,WAAW,mCACV,YAAY,KACf,UAAU,EAAE,OAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,QAAQ,EAAE,KAAI,IAAI,EACtC,OAAO,EAAE,gBAAgB,CAAC,YAAY,CAAC,OAAO,CAAC,EAC/C,OAAO,EAAE,mBAAmB,CAAC,YAAY,CAAC,OAAO,IAAI,EAAE,CAAC,EACxD,IAAI,EAAE,+BAAW,EAAC,YAAY,CAAC,IAAI,CAAC,GACvC,CAAC;IAEF,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC;AACjC,CAAC;AAtBD,8BAsBC;AAED;;;GAGG;AACH,SAAS,gBAAgB,CAAC,YAAsC;IAC5D,MAAM,cAAc,GAA8B,EAAE,CAAC;IACrD,IAAI,YAAY,EAAE;QACd,KAAK,MAAM,GAAG,IAAI,YAAY,EAAE;YAC5B,IAAI,YAAY,CAAC,GAAG,CAAC,IAAI,IAAI,EAAE;gBAC3B,cAAc,CAAC,GAAG,CAAC,GAAG,YAAY,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC;aACtD;SACJ;KACJ;IACD,OAAO,cAAc,CAAC;AAC1B,CAAC;AAED;;;GAGG;AACH,SAAgB,mBAAmB,CAAC,YAAsB;IACtD,MAAM,UAAU,GAAoB,EAAE,CAAC;IACvC,YAAY,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,EAAE;QAC5B,UAAU,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC;IAC7C,CAAC,CAAC,CAAC;IAEH,OAAO,UAAU,CAAC;AACtB,CAAC;AAPD,kDAOC;AAED;;;GAGG;AACH,SAAS,eAAe,CAAC,WAAmB;IACxC,iDAAiD;IACjD,IAAI,WAAW,GAA0B,MAAM,CAAC;IAChD,IAAI,WAAW,IAAI,WAAW,CAAC,QAAQ,EAAE;QACrC,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC;QAC1D,IAAI,QAAQ,KAAK,KAAK,EAAE;YACpB,WAAW,GAAG,KAAK,CAAC;SACvB;aAAM,IAAI,QAAQ,KAAK,QAAQ,EAAE;YAC9B,WAAW,GAAG,QAAQ,CAAC;SAC1B;aAAM,IAAI,QAAQ,KAAK,MAAM,EAAE;YAC5B,WAAW,GAAG,cAAc,CAAC;SAChC;KACJ;IAED,MAAM,SAAS,GAAkB;QAC7B,IAAI,EAAE,WAAW,IAAI,+BAAW,EAAC,WAAW,CAAC,IAAI,EAAE,aAAa,CAAC;QACjE,KAAK,EAAE,WAAW,IAAI,+BAAW,EAAC,WAAW,CAAC,KAAK,EAAE,cAAc,CAAC;QACpE,MAAM,EAAE,oCAAgB,EAAC,WAAW,IAAI,WAAW,CAAC,MAAM,EAAE,eAAe,CAAC;QAC5E,IAAI,EAAE,oCAAgB,EAAC,WAAW,IAAI,WAAW,CAAC,IAAI,EAAE,aAAa,CAAC;QACtE,OAAO,EAAE,uCAAmB,EAAC,WAAW,IAAI,WAAW,CAAC,OAAO,EAAE,gBAAgB,CAAC;QAClF,MAAM,EAAE,kCAAc,EAAC,WAAW,IAAI,WAAW,CAAC,MAAM,EAAE,eAAe,CAAC;QAC1E,QAAQ,EAAE,kCAAc,EAAC,WAAW,IAAI,WAAW,CAAC,QAAQ,EAAE,iBAAiB,CAAC;QAChF,QAAQ,EAAE,WAAW;QACrB,MAAM,EAAE,oCAAgB,EAAC,WAAW,IAAI,WAAW,CAAC,MAAM,EAAE,eAAe,CAAC;KAC/E,CAAC;IAEF,OAAO,SAAS,CAAC;AACrB,CAAC;;;;;;;;;;;;AC7ID,sDAAsD;AACtD,kCAAkC;;;AAUlC,MAAa,iBAAkB,SAAQ,KAAK;IAA5C;;QACI,gCAA2B,GAAG,IAAI,CAAC;IACvC,CAAC;CAAA;AAFD,8CAEC;AAED,MAAa,eAAgB,SAAQ,SAAS;IAA9C;;QACI,gCAA2B,GAAG,IAAI,CAAC;IACvC,CAAC;CAAA;AAFD,0CAEC;AAED,MAAa,gBAAiB,SAAQ,UAAU;IAAhD;;QACI,gCAA2B,GAAG,IAAI,CAAC;IACvC,CAAC;CAAA;AAFD,4CAEC;AAED,MAAa,aAAc,SAAQ,eAAe;IAC9C,YAAY,YAAoB;QAC5B,KAAK,CAAC,wCAAwC,YAAY,GAAG,CAAC,CAAC;IACnE,CAAC;CACJ;AAJD,sCAIC;AAED,SAAgB,eAAe,CAAC,GAAY;IACxC,IAAI,GAAG,YAAY,KAAK,EAAE;QACtB,OAAO,GAAG,CAAC;KACd;SAAM;QACH,IAAI,OAAe,CAAC;QACpB,IAAI,GAAG,KAAK,SAAS,IAAI,GAAG,KAAK,IAAI,EAAE;YACnC,OAAO,GAAG,eAAe,CAAC;SAC7B;aAAM,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;YAChC,OAAO,GAAG,GAAG,CAAC;SACjB;aAAM,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;YAChC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;SACjC;aAAM;YACH,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QACD,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;KAC7B;AACL,CAAC;AAhBD,0CAgBC;AAED;;;GAGG;AACH,SAAgB,OAAO,CAAC,GAAY;IAChC,OAAO,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,SAAS,CAAC;AAC7C,CAAC;AAFD,0BAEC;;;;;;;;;;;;ACrDD,sDAAsD;AACtD,kCAAkC;;;;;;;;;;;;;;;AAYlC,yEAAoC;AACpC,kFAAqD;AACrD,oHAA4D;AAC5D,gIAAuF;AACvF,yEAA8C;AAC9C,kGAAiD;AACjD,yIAA0E;AAE1E,MAAa,OAAO;IAahB,YAAY,OAAoB;;QAFhC,sCAAqC;QAGjC,IAAI,CAAC,MAAM,GAAe,OAAO,CAAC,MAAM,CAAC;QACzC,IAAI,CAAC,GAAG,GAAW,OAAO,CAAC,GAAG,CAAC;QAC/B,IAAI,CAAC,WAAW,GAAW,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,OAAO,GAAG,2CAAmB,EAAC,OAAO,CAAC,eAAe,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;QAC7E,IAAI,CAAC,KAAK,GAAG,2CAAmB,EAAC,OAAO,CAAC,aAAa,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;QACvE,IAAI,CAAC,MAAM,GAAG,2CAAmB,EAAC,OAAO,CAAC,cAAc,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;QAE1E,IAAI,aAAO,CAAC,IAAI,0CAAE,KAAK,EAAE;YACrB,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAClD,yJAAyJ;YACzJ,4HAA4H;YAC5H,oEAAoE;YACpE,iJAAiJ;YACjJ,8MAA8M;YAE9M,MAAM,WAAW,GAAG,UAAI,CAAC,GAAG,CAAC,sBAAU,CAAC,WAAW,CAAC,0CAAE,WAAW,EAAE,CAAC;YACpE,IAAI,UAA2C,CAAC;YAChD,IAAI,WAAW,KAAK,qBAAS,CAAC,WAAW,KAAI,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,UAAU,CAAC,qBAAS,CAAC,eAAe,CAAC,GAAE;gBAC7F,qFAAqF;gBACrF,gLAAgL;gBAChL,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC;aAC7B;iBAAM;gBACH,yDAAyD;gBACzD,UAAU,GAAG;oBACT,MAAM,EAAE,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC;iBACxC,CAAC;aACL;YAED,IAAI,CAAC,IAAI,GAAG,iCAAa,EAAC,UAAU,CAAC,CAAC;YACtC,IAAI,CAAC,OAAO,GAAG,uCAAe,EAAC,UAAU,CAAC,CAAC;SAC9C;IACL,CAAC;IAED,IAAI,IAAI;QACJ,IAAI,2BAAI,2BAAY,KAAK,SAAS,EAAE;YAChC,2BAAI,uBAAe,2DAA0B,EAAC,IAAI,CAAC,OAAO,CAAC,OAAC;SAC/D;QAED,OAAO,2BAAI,2BAAY,CAAC;IAC5B,CAAC;IAED,GAAG,CAAC,KAAa;QACb,OAAO,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;IAC7D,CAAC;IAED,aAAa;QACT,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,sBAAU,CAAC,WAAW,CAAC,CAAC;QACrD,IAAI,CAAC,WAAW,EAAE;YACd,MAAM,IAAI,0BAAiB,CAAC,IAAI,sBAAU,CAAC,WAAW,2BAA2B,CAAC,CAAC;SACtF;aAAM;YACH,OAAO,yBAAS,EAAC,IAAI,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;SAC5C;IACL,CAAC;CACJ;AAnED,0BAmEC;;AAED;;;;;IAKI;AACJ,SAAS,YAAY,CAAC,MAAc;IAChC,IAAI,QAAQ,GAAG,MAAM,CAAC;IACtB,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;QAC1C,QAAQ,GAAG,SAAS,CAAC,CAAC,kDAAkD;QACxE,MAAM,GAAG,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;KACtC;SAAM,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;QACjD,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE;YACpC,QAAQ,GAAG,SAAS,CAAC,CAAC,yCAAyC;YAC/D,MAAM,GAAG,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;SACtC;aAAM;YACH,QAAQ,GAAG,SAAS,CAAC;YACrB,MAAM,GAAG,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;SACtC;KACJ;SAAM,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;QACvE,QAAQ,GAAG,MAAM,CAAC;QAClB,MAAM,GAAG,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;KACtC;SAAM,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;QACvF,QAAQ,GAAG,SAAS,CAAC;QACrB,MAAM,GAAG,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;KACtC;IAED,2GAA2G;IAC3G,iHAAiH;IACjH,OAAO,uBAAM,EAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;AACpC,CAAC;AAED,SAAS,cAAc,CAAC,MAAc,EAAE,CAAS;IAC7C,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC9B,CAAC;;;;;;;;;;;;AC5HD,sDAAsD;AACtD,kCAAkC;;;AAGlC,kFAAqD;AAErD,MAAa,QAAQ;IAWjB,YAAY,IAAc;QAT1B,YAAO,GAA2B,EAAE,CAAC;QACrC,YAAO,GAAa,EAAE,CAAC;QAyDvB,SAAI,GAAG,IAAI,CAAC,GAAG,CAAC;QAChB,WAAM,GAAG,IAAI,CAAC,SAAS,CAAC;QACxB,QAAG,GAAG,IAAI,CAAC,SAAS,CAAC;QACrB,QAAG,GAAG,IAAI,CAAC,SAAS,CAAC;QAnDjB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACtB,CAAC;IAED,GAAG,CAAC,IAAU;QACV,IAAI,IAAI,KAAK,SAAS,EAAE;YACpB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;SACpB;QACD,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,SAAS,CAAC,KAAa,EAAE,GAAQ;QAC7B,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,GAAG,GAAG,CAAC;QACxC,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,SAAS,CAAC,KAAa;QACnB,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;IAC7C,CAAC;IAED,YAAY,CAAC,KAAa;QACtB,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;QACzC,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,MAAM,CAAC,UAA2B;QAC9B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,UAAU,CAAC,UAA2B;QAClC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACxB,mDAAmD;QACnD,OAAO,IAAI,CAAC,GAAG,EAAE,CAAC;IACtB,CAAC;IAED,IAAI,CAAC,IAAI;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,sBAAU,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IAClD,CAAC;IAED,IAAI,CAAC,IAAI;QACL,IAAI,CAAC,IAAI,CAAC,qBAAS,CAAC,IAAI,CAAC,CAAC;QAC1B,mDAAmD;QACnD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChB,OAAO;IACX,CAAC;IAOD,gJAAgJ;IAChJ,cAAc;QACV,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;YACzB,IAAI,IAAI,CAAC,GAAG,CAAC,sBAAU,CAAC,WAAW,CAAC,EAAE;gBAClC,2CAA2C;gBAC3C,OAAO;aACV;YAED,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;gBAC5B,IAAI,CAAC,IAAI,CAAC,qBAAS,CAAC,WAAW,CAAC,CAAC;aACpC;SACJ;IACL,CAAC;CACJ;AA9ED,4BA8EC;;;;;;;;;;;;ACpFD,sDAAsD;AACtD,kCAAkC;;;AAIlC,SAAgB,0BAA0B,CAAC,OAA2B;IAClE,IAAI,IAAI,GAA2B,IAAI,CAAC;IAExC,IAAI,OAAO,CAAC,uBAAuB,CAAC,EAAE;QAClC,MAAM,mBAAmB,GAAG,IAAI,CAAC,KAAK,CAClC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAuB,CAAC,EAAE,QAAQ,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAC5E,CAAC;QAEF,IAAI,mBAAmB,CAAC,kBAAkB,CAAC,EAAE;YACzC,IAAI,GAAG;gBACH,IAAI,EAAE,eAAe;gBACrB,EAAE,EAAE,mBAAmB,CAAC,QAAQ,CAAC;gBACjC,QAAQ,EAAE,mBAAmB,CAAC,aAAa,CAAC;gBAC5C,gBAAgB,EAAE,mBAAmB,CAAC,kBAAkB,CAAC;gBACzD,mBAAmB;aACtB,CAAC;SACL;aAAM;YACH,IAAI,GAAG;gBACH,IAAI,EAAE,YAAY;gBAClB,EAAE,EAAE,OAAO,CAAC,0BAA0B,CAAC;gBACvC,QAAQ,EAAE,OAAO,CAAC,4BAA4B,CAAC;gBAC/C,gBAAgB,EAAE,OAAO,CAAC,2BAA2B,CAAC;gBACtD,mBAAmB;aACtB,CAAC;SACL;KACJ;IAED,OAAO,IAAI,CAAC;AAChB,CAAC;AA5BD,gEA4BC;;;;;;;;;;;;ACjCD,sDAAsD;AACtD,kCAAkC;;;;;;;;;;;;;;;AAGlC,kFAAyC;AACzC,yEAA8C;AAC9C,+FAAiD;AACjD,oHAA0D;AAE1D;;GAEG;AACH,SAAgB,SAAS,CAAC,IAAqB,EAAE,WAAmB;IAChE,MAAM,CAAC,SAAS,EAAE,UAAU,CAAC,GAAG,kCAAgB,EAAC,WAAW,CAAC,CAAC;IAC9D,QAAQ,SAAS,CAAC,WAAW,EAAE,EAAE;QAC7B,KAAK,qBAAS,CAAC,aAAa,CAAC,CAAC;YAC1B,MAAM,QAAQ,GAAG,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAC5C,MAAM,KAAK,GAAG,2CAAkB,EAAC,OAAO,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;YAChG,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;SAC1B;QACD,KAAK,qBAAS,CAAC,cAAc,CAAC,CAAC;YAC3B,MAAM,MAAM,GAAG,IAAI,eAAe,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YACpD,MAAM,KAAK,GAA+B,EAAE,CAAC;YAC7C,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,EAAE;gBAC/B,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;aACpD;YACD,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;SAC1B;QACD;YACI,MAAM,IAAI,0BAAiB,CACvB,eAAe,SAAS,uDAAuD,qBAAS,CAAC,aAAa,OAAO,qBAAS,CAAC,cAAc,IAAI,CAC5I,CAAC;KACT;AACL,CAAC;AArBD,8BAqBC;AAED,MAAa,IAAI;IAEb,YAAY,KAAiC;QAD7C,8BAAmC;QAE/B,2BAAI,eAAU,KAAK,OAAC;IACxB,CAAC;IAED,GAAG,CAAC,IAAY;QACZ,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,2BAAI,mBAAO,EAAE;YACpC,IAAI,GAAG,KAAK,IAAI,EAAE;gBACd,OAAO,KAAK,CAAC;aAChB;SACJ;QACD,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,MAAM,CAAC,IAAY;QACf,MAAM,MAAM,GAAqB,EAAE,CAAC;QACpC,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,2BAAI,mBAAO,EAAE;YACpC,IAAI,GAAG,KAAK,IAAI,EAAE;gBACd,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACtB;SACJ;QACD,OAAO,MAAM,CAAC;IAClB,CAAC;IAED,GAAG,CAAC,IAAY;QACZ,KAAK,MAAM,CAAC,GAAG,CAAC,IAAI,2BAAI,mBAAO,EAAE;YAC7B,IAAI,GAAG,KAAK,IAAI,EAAE;gBACd,OAAO,IAAI,CAAC;aACf;SACJ;QACD,OAAO,KAAK,CAAC;IACjB,CAAC;IAED,+BAAC,MAAM,CAAC,QAAQ,EAAC;QACb,OAAO,2BAAI,mBAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC;IAC1C,CAAC;IAED,IAAI,MAAM;QACN,OAAO,2BAAI,mBAAO,CAAC,MAAM,CAAC;IAC9B,CAAC;CACJ;AAzCD,oBAyCC;;;;;;;;;;;;AC5ED,sDAAsD;AACtD,kCAAkC;;;;;;;;;AAElC,kFAA0C;AAC1C,yEAA8C;AAE9C,MAAM,KAAK,GAAG,GAAG,CAAC;AAClB,iIAAiI;AACjI,MAAM,QAAQ,GAAG,wBAAwB,CAAC;AAC1C,MAAM,YAAY,GAAG,qBAAqB,CAAC;AAC3C,kJAAkJ;AAClJ,MAAM,SAAS,GAAG,mCAAmC,CAAC;AACtD,MAAM,KAAK,GAAG,KAAK,KAAK,GAAG,QAAQ,GAAG,SAAS,IAAI,CAAC;AAEpD,MAAM,KAAK,GAAG,OAAO,CAAC,CAAC,4BAA4B;AACnD,MAAM,GAAG,GAAG,WAAW,CAAC,CAAC,wDAAwD;AACjF,MAAM,YAAY,GAAG,SAAS,GAAG,EAAE,CAAC,CAAC,sEAAsE;AAE3G;;;;GAIG;AACH,SAAgB,cAAc,CAAC,IAAY,EAAE,UAAkB;IAC3D,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,GAAG,KAAK,GAAG,UAAU,QAAQ,GAAG,EAAE,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC7E,IAAI,KAAK,EAAE;QACP,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;KAC1B;IACD,OAAO,IAAI,CAAC;AAChB,CAAC;AAND,wCAMC;AAED;;;GAGG;AACH,SAAgB,gBAAgB,CAAC,IAAY;IACzC,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,GAAG,KAAK,IAAI,KAAK,MAAM,KAAK,IAAI,YAAY,EAAE,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACzF,IAAI,CAAC,KAAK,EAAE;QACR,MAAM,IAAI,0BAAiB,CAAC,GAAG,sBAAU,CAAC,WAAW,yCAAyC,CAAC,CAAC;KACnG;SAAM;QACH,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;KAClD;AACL,CAAC;AAPD,4CAOC;AAED;;;GAGG;AACH,SAAgB,uBAAuB,CAAC,IAAY;IAChD,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,GAAG,KAAK,IAAI,KAAK,IAAI,YAAY,EAAE,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9E,IAAI,CAAC,KAAK,EAAE;QACR,MAAM,IAAI,0BAAiB,CAAC,GAAG,sBAAU,CAAC,kBAAkB,oCAAoC,CAAC,CAAC;KACrG;SAAM;QACH,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;KAClD;AACL,CAAC;AAPD,0DAOC;AAED,SAAS,iBAAiB,CAAC,IAAY;IACnC,MAAM,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;IAClC,OAAO,IAAI,EAAE;QACT,gDAAgD;QAChD,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,GAAG,KAAK,IAAI,KAAK,MAAM,KAAK,IAAI,YAAY,EAAE,EAAE,GAAG,CAAC,CAAC;QAC/E,IAAI,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC9B,sEAAsE;QACtE,IAAI,CAAC,KAAK,EAAE;YACR,MAAM,iBAAiB,GAAG,IAAI,MAAM,CAAC,GAAG,KAAK,IAAI,KAAK,OAAO,YAAY,KAAK,YAAY,EAAE,EAAE,GAAG,CAAC,CAAC;YACnG,KAAK,GAAG,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACxC;QAED,IAAI,KAAK,EAAE;YACP,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,uBAAuB;YAC5E,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;SACnB;aAAM;YACH,MAAM;SACT;KACJ;IACD,OAAO,MAAM,CAAC;AAClB,CAAC;AAED,MAAa,YAAY;IAAzB;QACI,+BAAsC,EAAE,EAAC;IAiB7C,CAAC;IAhBG,GAAG,CAAC,IAAY;QACZ,MAAM,MAAM,GAAG,2BAAI,4BAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;QAChD,IAAI,MAAM,KAAK,SAAS,EAAE;YACtB,MAAM,IAAI,0BAAiB,CAAC,uCAAuC,IAAI,IAAI,CAAC,CAAC;SAChF;aAAM;YACH,OAAO,MAAM,CAAC;SACjB;IACL,CAAC;IAED,GAAG,CAAC,IAAY;QACZ,OAAO,2BAAI,4BAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,KAAK,SAAS,CAAC;IAC1D,CAAC;IAED,GAAG,CAAC,IAAY,EAAE,KAAa;QAC3B,2BAAI,4BAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,GAAG,KAAK,CAAC;IAC7C,CAAC;CACJ;AAlBD,oCAkBC;;;;;;;;;;;;;ACjGD,sDAAsD;AACtD,kCAAkC;;;AAGlC,kFAA0C;AAC1C,yEAA8C;AAC9C,+FAAwE;AAExE,MAAM,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5C,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AAErC,kFAAkF;AAClF,SAAgB,kBAAkB,CAAC,KAAa,EAAE,QAAgB;IAC9D,MAAM,MAAM,GAAyB,EAAE,CAAC;IACxC,IAAI,WAA+B,CAAC;IACpC,IAAI,WAAiC,CAAC;IACtC,IAAI,SAAS,GAAG,KAAK,CAAC;IAEtB,MAAM,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,QAAQ,EAAE,CAAC,CAAC;IACpD,MAAM,iBAAiB,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,QAAQ,IAAI,CAAC,CAAC;IAEzD,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,IAAI,OAAO,GAAG,CAAC,CAAC;IAChB,IAAI,cAAc,GAAG,CAAC,CAAC;IACvB,IAAI,YAAY,GAAG,CAAC,CAAC;IAErB,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,KAAK,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;QAC/C,IAAI,IAAY,CAAC;QACjB,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,OAAO,EAAE;YAC1B,OAAO,GAAG,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,cAAc,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;YAClE,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YACvC,SAAS,GAAG,KAAK,GAAG,CAAC,CAAC;SACzB;aAAM;YACH,SAAS;SACZ;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QAC/C,MAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QACrD,IAAI,UAAU,IAAI,aAAa,EAAE;YAC7B,IAAI,WAAW,EAAE;gBACb,WAAW,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,cAAc,EAAE,YAAY,CAAC,CAAC;aACjE;YAED,IAAI,aAAa,EAAE;gBACf,MAAM;aACT;YAED,WAAW,GAAG;gBACV,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC;aACzB,CAAC;YACF,SAAS,GAAG,IAAI,CAAC;SACpB;aAAM,IAAI,SAAS,EAAE;YAClB,IAAI,CAAC,WAAW,EAAE;gBACd,MAAM,IAAI,0BAAiB,CAAC,8CAA8C,QAAQ,IAAI,CAAC,CAAC;aAC3F;YAED,MAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;YACrC,IAAI,CAAC,YAAY,EAAE;gBACf,+DAA+D;gBAC/D,SAAS,GAAG,KAAK,CAAC;gBAClB,IAAI,CAAC,WAAW,EAAE;oBACd,MAAM,IAAI,0BAAiB,CACvB,iCAAiC,sBAAU,CAAC,kBAAkB,0BAA0B,CAC3F,CAAC;iBACL;qBAAM;oBACH,cAAc,GAAG,SAAS,CAAC;oBAC3B,YAAY,GAAG,SAAS,CAAC;oBACzB,MAAM,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC,CAAC;iBAC3C;aACJ;iBAAM;gBACH,MAAM,kBAAkB,GAAG,gCAAc,EAAC,YAAY,EAAE,sBAAU,CAAC,kBAAkB,CAAC,CAAC;gBACvF,IAAI,kBAAkB,EAAE;oBACpB,MAAM,CAAC,EAAE,gBAAgB,CAAC,GAAG,yCAAuB,EAAC,kBAAkB,CAAC,CAAC;oBACzE,WAAW,GAAG,gBAAgB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;oBAE3C,uCAAuC;oBACvC,IAAI,gBAAgB,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;wBAClC,WAAW,CAAC,QAAQ,GAAG,gBAAgB,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;qBAC3D;iBACJ;qBAAM;oBACH,MAAM,WAAW,GAAG,gCAAc,EAAC,YAAY,EAAE,sBAAU,CAAC,WAAW,CAAC,CAAC;oBACzE,IAAI,WAAW,EAAE;wBACb,WAAW,CAAC,WAAW,GAAG,WAAW,CAAC;qBACzC;iBACJ;aACJ;SACJ;aAAM;YACH,YAAY,GAAG,OAAO,CAAC;SAC1B;KACJ;IAED,OAAO,MAAM,CAAC;AAClB,CAAC;AAhFD,gDAgFC;;;;;;;;;;;AC5FD;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;;;ACtBA,sDAAsD;AACtD,kCAAkC;;;AAGlC,mGAAmF;AACnF,iFAAsC;AACtC,mGAAoD;AAEpD,MAAM,gBAAgB;IAAtB;QACI,SAAI,GAAG,kBAAkB,CAAC;QAC1B,YAAO,GAAG,mBAAO,CAAC;IAItB,CAAC;IAHG,kBAAkB,CAAC,OAA8B;QAC7C,OAAO,IAAI,iCAAe,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC;CACJ;AAED,SAAgB,KAAK;IACjB,wCAAmB,EAAC,IAAI,gBAAgB,EAAE,CAAC,CAAC;AAChD,CAAC;AAFD,sBAEC","sources":["webpack://@azure/functions/./src/Context.ts","webpack://@azure/functions/./src/FunctionInfo.ts","webpack://@azure/functions/./src/InvocationModel.ts","webpack://@azure/functions/./src/constants.ts","webpack://@azure/functions/./src/converters/BindingConverters.ts","webpack://@azure/functions/./src/converters/RpcConverters.ts","webpack://@azure/functions/./src/converters/RpcHttpConverters.ts","webpack://@azure/functions/./src/errors.ts","webpack://@azure/functions/./src/http/Request.ts","webpack://@azure/functions/./src/http/Response.ts","webpack://@azure/functions/./src/http/extractHttpUserFromHeaders.ts","webpack://@azure/functions/./src/parsers/parseForm.ts","webpack://@azure/functions/./src/parsers/parseHeader.ts","webpack://@azure/functions/./src/parsers/parseMultipartForm.ts","webpack://@azure/functions/external commonjs2 \"@azure/functions-core\"","webpack://@azure/functions/external commonjs2 \"events\"","webpack://@azure/functions/external commonjs2 \"iconv-lite\"","webpack://@azure/functions/external commonjs2 \"long\"","webpack://@azure/functions/external commonjs2 \"util\"","webpack://@azure/functions/external commonjs2 \"uuid\"","webpack://@azure/functions/webpack/bootstrap","webpack://@azure/functions/./src/index.ts"],"sourcesContent":["// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport {\r\n    BindingDefinition,\r\n    Context,\r\n    ContextBindingData,\r\n    ContextBindings,\r\n    ExecutionContext,\r\n    Logger,\r\n    TraceContext,\r\n} from '@azure/functions';\r\nimport { RpcInvocationRequest, RpcLogLevel, RpcParameterBinding } from '@azure/functions-core';\r\nimport { v4 as uuid } from 'uuid';\r\nimport {\r\n    convertKeysToCamelCase,\r\n    getBindingDefinitions,\r\n    getNormalizedBindingData,\r\n} from './converters/BindingConverters';\r\nimport { fromRpcTraceContext, fromTypedData } from './converters/RpcConverters';\r\nimport { FunctionInfo } from './FunctionInfo';\r\nimport { Request } from './http/Request';\r\nimport { Response } from './http/Response';\r\nimport EventEmitter = require('events');\r\n\r\nexport function CreateContextAndInputs(\r\n    info: FunctionInfo,\r\n    request: RpcInvocationRequest,\r\n    userLogCallback: UserLogCallback,\r\n    doneEmitter: EventEmitter\r\n) {\r\n    const context = new InvocationContext(info, request, userLogCallback, doneEmitter);\r\n\r\n    const bindings: ContextBindings = {};\r\n    const inputs: any[] = [];\r\n    let httpInput: Request | undefined;\r\n    for (const binding of <RpcParameterBinding[]>request.inputData) {\r\n        if (binding.data && binding.name) {\r\n            let input;\r\n            if (binding.data && binding.data.http) {\r\n                input = httpInput = new Request(binding.data.http);\r\n            } else {\r\n                // TODO: Don't hard code fix for camelCase https://github.com/Azure/azure-functions-nodejs-worker/issues/188\r\n                if (info.getTimerTriggerName() === binding.name) {\r\n                    // v2 worker converts timer trigger object to camelCase\r\n                    input = convertKeysToCamelCase(binding)['data'];\r\n                } else {\r\n                    input = fromTypedData(binding.data);\r\n                }\r\n            }\r\n            bindings[binding.name] = input;\r\n            inputs.push(input);\r\n        }\r\n    }\r\n\r\n    context.bindings = bindings;\r\n    if (httpInput) {\r\n        context.req = httpInput;\r\n        context.res = new Response(context.done);\r\n        // This is added for backwards compatability with what the host used to send to the worker\r\n        context.bindingData.sys = {\r\n            methodName: info.name,\r\n            utcNow: new Date().toISOString(),\r\n            randGuid: uuid(),\r\n        };\r\n        // Populate from HTTP request for backwards compatibility if missing\r\n        if (!context.bindingData.query) {\r\n            context.bindingData.query = Object.assign({}, httpInput.query);\r\n        }\r\n        if (!context.bindingData.headers) {\r\n            context.bindingData.headers = Object.assign({}, httpInput.headers);\r\n        }\r\n    }\r\n    return {\r\n        context: <Context>context,\r\n        inputs: inputs,\r\n    };\r\n}\r\n\r\nclass InvocationContext implements Context {\r\n    invocationId: string;\r\n    executionContext: ExecutionContext;\r\n    bindings: ContextBindings;\r\n    bindingData: ContextBindingData;\r\n    traceContext: TraceContext;\r\n    bindingDefinitions: BindingDefinition[];\r\n    log: Logger;\r\n    req?: Request;\r\n    res?: Response;\r\n    done: DoneCallback;\r\n\r\n    constructor(\r\n        info: FunctionInfo,\r\n        request: RpcInvocationRequest,\r\n        userLogCallback: UserLogCallback,\r\n        doneEmitter: EventEmitter\r\n    ) {\r\n        this.invocationId = <string>request.invocationId;\r\n        this.traceContext = fromRpcTraceContext(request.traceContext);\r\n        const executionContext = <ExecutionContext>{\r\n            invocationId: this.invocationId,\r\n            functionName: info.name,\r\n            functionDirectory: info.directory,\r\n            retryContext: request.retryContext,\r\n        };\r\n        this.executionContext = executionContext;\r\n        this.bindings = {};\r\n\r\n        // Log message that is tied to function invocation\r\n        this.log = Object.assign((...args: any[]) => userLogCallback('information', ...args), {\r\n            error: (...args: any[]) => userLogCallback('error', ...args),\r\n            warn: (...args: any[]) => userLogCallback('warning', ...args),\r\n            info: (...args: any[]) => userLogCallback('information', ...args),\r\n            verbose: (...args: any[]) => userLogCallback('trace', ...args),\r\n        });\r\n\r\n        this.bindingData = getNormalizedBindingData(request);\r\n        this.bindingDefinitions = getBindingDefinitions(info);\r\n\r\n        this.done = (err?: unknown, result?: any) => {\r\n            doneEmitter.emit('done', err, result);\r\n        };\r\n    }\r\n}\r\n\r\nexport interface InvocationResult {\r\n    return: any;\r\n    bindings: ContextBindings;\r\n}\r\n\r\nexport type DoneCallback = (err?: unknown, result?: any) => void;\r\n\r\nexport type UserLogCallback = (level: RpcLogLevel, ...args: any[]) => void;\r\n\r\nexport interface Dict<T> {\r\n    [key: string]: T;\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { RpcBindingInfo, RpcFunctionMetadata, RpcTypedData } from '@azure/functions-core';\r\nimport { toTypedData } from './converters/RpcConverters';\r\nimport { toRpcHttp } from './converters/RpcHttpConverters';\r\n\r\nconst returnBindingKey = '$return';\r\n\r\nexport class FunctionInfo {\r\n    name: string;\r\n    directory: string;\r\n    bindings: {\r\n        [key: string]: RpcBindingInfo;\r\n    };\r\n    outputBindings: {\r\n        [key: string]: RpcBindingInfo & { converter: (any) => RpcTypedData };\r\n    };\r\n    httpOutputName: string;\r\n    hasHttpTrigger: boolean;\r\n\r\n    constructor(metadata: RpcFunctionMetadata) {\r\n        this.name = <string>metadata.name;\r\n        this.directory = <string>metadata.directory;\r\n        this.bindings = {};\r\n        this.outputBindings = {};\r\n        this.httpOutputName = '';\r\n        this.hasHttpTrigger = false;\r\n\r\n        if (metadata.bindings) {\r\n            const bindings = (this.bindings = metadata.bindings);\r\n\r\n            // determine output bindings & assign rpc converter (http has quirks)\r\n            Object.keys(bindings)\r\n                .filter((name) => bindings[name].direction !== 'in')\r\n                .forEach((name) => {\r\n                    const type = bindings[name].type;\r\n                    if (type && type.toLowerCase() === 'http') {\r\n                        this.httpOutputName = name;\r\n                        this.outputBindings[name] = Object.assign(bindings[name], { converter: toRpcHttp });\r\n                    } else {\r\n                        this.outputBindings[name] = Object.assign(bindings[name], { converter: toTypedData });\r\n                    }\r\n                });\r\n\r\n            this.hasHttpTrigger =\r\n                Object.keys(bindings).filter((name) => {\r\n                    const type = bindings[name].type;\r\n                    return type && type.toLowerCase() === 'httptrigger';\r\n                }).length > 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return output binding details on the special key \"$return\" output binding\r\n     */\r\n    getReturnBinding() {\r\n        return this.outputBindings[returnBindingKey];\r\n    }\r\n\r\n    getTimerTriggerName(): string | undefined {\r\n        for (const name in this.bindings) {\r\n            const type = this.bindings[name].type;\r\n            if (type && type.toLowerCase() === 'timertrigger') {\r\n                return name;\r\n            }\r\n        }\r\n        return;\r\n    }\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { AzureFunction, Context } from '@azure/functions';\r\nimport * as coreTypes from '@azure/functions-core';\r\nimport {\r\n    CoreInvocationContext,\r\n    InvocationArguments,\r\n    RpcInvocationResponse,\r\n    RpcLogCategory,\r\n    RpcLogLevel,\r\n    RpcParameterBinding,\r\n} from '@azure/functions-core';\r\nimport { format } from 'util';\r\nimport { CreateContextAndInputs } from './Context';\r\nimport { toTypedData } from './converters/RpcConverters';\r\nimport { isError } from './errors';\r\nimport { FunctionInfo } from './FunctionInfo';\r\nimport EventEmitter = require('events');\r\n\r\nconst asyncDoneLearnMoreLink = 'https://go.microsoft.com/fwlink/?linkid=2097909';\r\n\r\nexport class InvocationModel implements coreTypes.InvocationModel {\r\n    #doneEmitter: EventEmitter = new EventEmitter();\r\n    #isDone = false;\r\n    #resultIsPromise = false;\r\n    #coreCtx: CoreInvocationContext;\r\n    #funcInfo: FunctionInfo;\r\n\r\n    constructor(coreCtx: CoreInvocationContext) {\r\n        this.#coreCtx = coreCtx;\r\n        this.#funcInfo = new FunctionInfo(coreCtx.metadata);\r\n    }\r\n\r\n    async getArguments(): Promise<InvocationArguments> {\r\n        const { context, inputs } = CreateContextAndInputs(\r\n            this.#funcInfo,\r\n            this.#coreCtx.request,\r\n            (level: RpcLogLevel, ...args: any[]) => this.#userLog(level, ...args),\r\n            this.#doneEmitter\r\n        );\r\n        return { context, inputs };\r\n    }\r\n\r\n    async invokeFunction(context: Context, inputs: unknown[], functionCallback: AzureFunction): Promise<unknown> {\r\n        const legacyDoneTask = new Promise((resolve, reject) => {\r\n            this.#doneEmitter.on('done', (err?: unknown, result?: unknown) => {\r\n                this.#onDone(context.suppressAsyncDoneError);\r\n                if (isError(err)) {\r\n                    reject(err);\r\n                } else {\r\n                    resolve(result);\r\n                }\r\n            });\r\n        });\r\n\r\n        try {\r\n            let rawResult = functionCallback(context, ...inputs);\r\n            this.#resultIsPromise = !!rawResult && typeof rawResult.then === 'function';\r\n            let resultTask: Promise<any>;\r\n            if (this.#resultIsPromise) {\r\n                rawResult = Promise.resolve(rawResult).then((r) => {\r\n                    this.#onDone(context.suppressAsyncDoneError);\r\n                    return r;\r\n                });\r\n                resultTask = Promise.race([rawResult, legacyDoneTask]);\r\n            } else {\r\n                resultTask = legacyDoneTask;\r\n            }\r\n\r\n            return await resultTask;\r\n        } finally {\r\n            this.#isDone = true;\r\n        }\r\n    }\r\n\r\n    async getResponse(context: Context, result: unknown): Promise<RpcInvocationResponse> {\r\n        const response: RpcInvocationResponse = { invocationId: this.#coreCtx.invocationId };\r\n        response.outputData = [];\r\n        const info = this.#funcInfo;\r\n\r\n        // Allow HTTP response from context.res if HTTP response is not defined from the context.bindings object\r\n        if (info.httpOutputName && context.res && context.bindings[info.httpOutputName] === undefined) {\r\n            context.bindings[info.httpOutputName] = context.res;\r\n        }\r\n\r\n        // As legacy behavior, falsy values get serialized to `null` in AzFunctions.\r\n        // This breaks Durable Functions expectations, where customers expect any\r\n        // JSON-serializable values to be preserved by the framework,\r\n        // so we check if we're serializing for durable and, if so, ensure falsy\r\n        // values get serialized.\r\n        const isDurableBinding = info?.bindings?.name?.type == 'activityTrigger';\r\n\r\n        const returnBinding = info.getReturnBinding();\r\n        // Set results from return / context.done\r\n        if (result || (isDurableBinding && result != null)) {\r\n            // $return binding is found: return result data to $return binding\r\n            if (returnBinding) {\r\n                response.returnValue = returnBinding.converter(result);\r\n                // $return binding is not found: read result as object of outputs\r\n            } else if (typeof result === 'object') {\r\n                response.outputData = Object.keys(info.outputBindings)\r\n                    .filter((key) => result[key] !== undefined)\r\n                    .map(\r\n                        (key) =>\r\n                            <RpcParameterBinding>{\r\n                                name: key,\r\n                                data: info.outputBindings[key].converter(result[key]),\r\n                            }\r\n                    );\r\n            }\r\n            // returned value does not match any output bindings (named or $return)\r\n            // if not http, pass along value\r\n            if (!response.returnValue && response.outputData.length == 0 && !info.hasHttpTrigger) {\r\n                response.returnValue = toTypedData(result);\r\n            }\r\n        }\r\n        // Set results from context.bindings\r\n        if (context.bindings) {\r\n            response.outputData = response.outputData.concat(\r\n                Object.keys(info.outputBindings)\r\n                    // Data from return prioritized over data from context.bindings\r\n                    .filter((key) => {\r\n                        const definedInBindings: boolean = context.bindings[key] !== undefined;\r\n                        const hasReturnValue = !!result;\r\n                        const hasReturnBinding = !!returnBinding;\r\n                        const definedInReturn: boolean =\r\n                            hasReturnValue &&\r\n                            !hasReturnBinding &&\r\n                            typeof result === 'object' &&\r\n                            result[key] !== undefined;\r\n                        return definedInBindings && !definedInReturn;\r\n                    })\r\n                    .map(\r\n                        (key) =>\r\n                            <RpcParameterBinding>{\r\n                                name: key,\r\n                                data: info.outputBindings[key].converter(context.bindings[key]),\r\n                            }\r\n                    )\r\n            );\r\n        }\r\n        return response;\r\n    }\r\n\r\n    #log(level: RpcLogLevel, logCategory: RpcLogCategory, ...args: any[]): void {\r\n        this.#coreCtx.log(level, logCategory, format.apply(null, <[any, any[]]>args));\r\n    }\r\n\r\n    #systemLog(level: RpcLogLevel, ...args: any[]) {\r\n        this.#log(level, 'system', ...args);\r\n    }\r\n\r\n    #userLog(level: RpcLogLevel, ...args: any[]): void {\r\n        if (this.#isDone && this.#coreCtx.state !== 'postInvocationHooks') {\r\n            let badAsyncMsg =\r\n                \"Warning: Unexpected call to 'log' on the context object after function execution has completed. Please check for asynchronous calls that are not awaited or calls to 'done' made before function execution completes. \";\r\n            badAsyncMsg += `Function name: ${this.#funcInfo.name}. Invocation Id: ${this.#coreCtx.invocationId}. `;\r\n            badAsyncMsg += `Learn more: ${asyncDoneLearnMoreLink}`;\r\n            this.#systemLog('warning', badAsyncMsg);\r\n        }\r\n        this.#log(level, 'user', ...args);\r\n    }\r\n\r\n    #onDone(suppressAsyncDoneError = false): void {\r\n        if (this.#isDone) {\r\n            if (this.#resultIsPromise && suppressAsyncDoneError) {\r\n                return;\r\n            }\r\n\r\n            const message = this.#resultIsPromise\r\n                ? `Error: Choose either to return a promise or call 'done'. Do not use both in your script. Learn more: ${asyncDoneLearnMoreLink}`\r\n                : \"Error: 'done' has already been called. Please check your script for extraneous calls to 'done'.\";\r\n            this.#systemLog('error', message);\r\n        }\r\n        this.#isDone = true;\r\n    }\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nexport const version = '3.5.1';\r\n\r\nexport enum HeaderName {\r\n    contentType = 'content-type',\r\n    contentDisposition = 'content-disposition',\r\n}\r\n\r\nexport enum MediaType {\r\n    multipartForm = 'multipart/form-data',\r\n    multipartPrefix = 'multipart/',\r\n    urlEncodedForm = 'application/x-www-form-urlencoded',\r\n    octetStream = 'application/octet-stream',\r\n    json = 'application/json',\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { BindingDefinition, ContextBindingData } from '@azure/functions';\r\nimport { RpcInvocationRequest } from '@azure/functions-core';\r\nimport { FunctionInfo } from '../FunctionInfo';\r\nimport { fromTypedData } from './RpcConverters';\r\n\r\nexport function getBindingDefinitions(info: FunctionInfo): BindingDefinition[] {\r\n    const bindings = info.bindings;\r\n    if (!bindings) {\r\n        return [];\r\n    }\r\n\r\n    return Object.keys(bindings).map((name) => {\r\n        return {\r\n            name: name,\r\n            type: bindings[name].type || '',\r\n            direction: bindings[name].direction || undefined,\r\n        };\r\n    });\r\n}\r\n\r\nexport function getNormalizedBindingData(request: RpcInvocationRequest): ContextBindingData {\r\n    const bindingData: ContextBindingData = {\r\n        invocationId: <string>request.invocationId,\r\n    };\r\n\r\n    // node binding data is camel cased due to language convention\r\n    if (request.triggerMetadata) {\r\n        Object.assign(bindingData, convertKeysToCamelCase(request.triggerMetadata));\r\n    }\r\n    return bindingData;\r\n}\r\n\r\n// Recursively convert keys of objects to camel case\r\nexport function convertKeysToCamelCase(obj: any) {\r\n    const output = {};\r\n    for (const key in obj) {\r\n        const camelCasedKey = key.charAt(0).toLocaleLowerCase() + key.slice(1);\r\n        try {\r\n            // Only \"undefined\" will be replaced with original object property. For example:\r\n            //{ string : \"0\" } -> 0\r\n            //{ string : \"false\" } -> false\r\n            //\"test\" -> \"test\" (undefined returned from fromTypedData)\r\n            const valueFromDataType = fromTypedData(obj[key]);\r\n            const value = valueFromDataType === undefined ? obj[key] : valueFromDataType;\r\n            // If the value is a JSON object (and not array and not http, which is already cased), convert keys to camel case\r\n            if (!Array.isArray(value) && typeof value === 'object' && value && value.http == undefined) {\r\n                output[camelCasedKey] = convertKeysToCamelCase(value);\r\n            } else {\r\n                output[camelCasedKey] = value;\r\n            }\r\n        } catch {\r\n            // Just use the original value if we failed to recursively convert for any reason\r\n            output[camelCasedKey] = obj[key];\r\n        }\r\n    }\r\n    return output;\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { TraceContext } from '@azure/functions';\r\nimport {\r\n    RpcNullableBool,\r\n    RpcNullableDouble,\r\n    RpcNullableString,\r\n    RpcNullableTimestamp,\r\n    RpcTraceContext,\r\n    RpcTypedData,\r\n} from '@azure/functions-core';\r\nimport { isLong } from 'long';\r\nimport { AzFuncSystemError } from '../errors';\r\n\r\n/**\r\n * Converts 'ITypedData' input from the RPC layer to JavaScript types.\r\n * TypedData can be string, json, or bytes\r\n * @param typedData ITypedData object containing one of a string, json, or bytes property\r\n * @param convertStringToJson Optionally parse the string input type as JSON\r\n */\r\nexport function fromTypedData(typedData?: RpcTypedData | null, convertStringToJson = true) {\r\n    typedData = typedData || {};\r\n    let str = typedData.string || typedData.json;\r\n    if (str !== undefined) {\r\n        if (convertStringToJson) {\r\n            try {\r\n                if (str != null) {\r\n                    str = JSON.parse(str);\r\n                }\r\n            } catch (err) {}\r\n        }\r\n        return str;\r\n    } else if (typedData.bytes) {\r\n        return Buffer.from(<Buffer>typedData.bytes);\r\n    } else if (typedData.collectionBytes && typedData.collectionBytes.bytes) {\r\n        const byteCollection = typedData.collectionBytes.bytes;\r\n        return byteCollection.map((element) => Buffer.from(<Buffer>element));\r\n    } else if (typedData.collectionString && typedData.collectionString.string) {\r\n        return typedData.collectionString.string;\r\n    } else if (typedData.collectionDouble && typedData.collectionDouble.double) {\r\n        return typedData.collectionDouble.double;\r\n    } else if (typedData.collectionSint64 && typedData.collectionSint64.sint64) {\r\n        const longCollection = typedData.collectionSint64.sint64;\r\n        return longCollection.map((element) => (isLong(element) ? element.toString() : element));\r\n    }\r\n}\r\n\r\n/**\r\n * Converts 'IRpcTraceContext' input from RPC layer to dictionary of key value pairs.\r\n * @param traceContext IRpcTraceContext object containing the activityId, tracestate and attributes.\r\n */\r\nexport function fromRpcTraceContext(traceContext: RpcTraceContext | null | undefined): TraceContext {\r\n    if (traceContext) {\r\n        return <TraceContext>{\r\n            traceparent: traceContext.traceParent,\r\n            tracestate: traceContext.traceState,\r\n            attributes: traceContext.attributes,\r\n        };\r\n    }\r\n\r\n    return <TraceContext>{};\r\n}\r\n\r\n/**\r\n * Converts JavaScript type data to 'ITypedData' to be sent through the RPC layer\r\n * TypedData can be string, json, or bytes\r\n * @param inputObject A JavaScript object that is a string, Buffer, ArrayBufferView, number, or object.\r\n */\r\nexport function toTypedData(inputObject): RpcTypedData {\r\n    if (typeof inputObject === 'string') {\r\n        return { string: inputObject };\r\n    } else if (Buffer.isBuffer(inputObject)) {\r\n        return { bytes: inputObject };\r\n    } else if (ArrayBuffer.isView(inputObject)) {\r\n        const bytes = new Uint8Array(inputObject.buffer, inputObject.byteOffset, inputObject.byteLength);\r\n        return { bytes: bytes };\r\n    } else if (typeof inputObject === 'number') {\r\n        if (Number.isInteger(inputObject)) {\r\n            return { int: inputObject };\r\n        } else {\r\n            return { double: inputObject };\r\n        }\r\n    } else {\r\n        return { json: JSON.stringify(inputObject) };\r\n    }\r\n}\r\n\r\n/**\r\n * Converts boolean input to an 'INullableBool' to be sent through the RPC layer.\r\n * Input that is not a boolean but is also not null or undefined logs a function app level warning.\r\n * @param nullable Input to be converted to an INullableBool if it is a valid boolean\r\n * @param propertyName The name of the property that the caller will assign the output to. Used for debugging.\r\n */\r\nexport function toNullableBool(nullable: boolean | undefined, propertyName: string): undefined | RpcNullableBool {\r\n    if (typeof nullable === 'boolean') {\r\n        return <RpcNullableBool>{\r\n            value: nullable,\r\n        };\r\n    }\r\n\r\n    if (nullable != null) {\r\n        throw new AzFuncSystemError(\r\n            `A 'boolean' type was expected instead of a '${typeof nullable}' type. Cannot parse value of '${propertyName}'.`\r\n        );\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Converts number or string that parses to a number to an 'INullableDouble' to be sent through the RPC layer.\r\n * Input that is not a valid number but is also not null or undefined logs a function app level warning.\r\n * @param nullable Input to be converted to an INullableDouble if it is a valid number\r\n * @param propertyName The name of the property that the caller will assign the output to. Used for debugging.\r\n */\r\nexport function toNullableDouble(\r\n    nullable: number | string | undefined,\r\n    propertyName: string\r\n): undefined | RpcNullableDouble {\r\n    if (typeof nullable === 'number') {\r\n        return <RpcNullableDouble>{\r\n            value: nullable,\r\n        };\r\n    } else if (typeof nullable === 'string') {\r\n        if (!isNaN(<any>nullable)) {\r\n            const parsedNumber = parseFloat(nullable);\r\n            return <RpcNullableDouble>{\r\n                value: parsedNumber,\r\n            };\r\n        }\r\n    }\r\n\r\n    if (nullable != null) {\r\n        throw new AzFuncSystemError(\r\n            `A 'number' type was expected instead of a '${typeof nullable}' type. Cannot parse value of '${propertyName}'.`\r\n        );\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Converts string input to an 'INullableString' to be sent through the RPC layer.\r\n * Input that is not a string but is also not null or undefined logs a function app level warning.\r\n * @param nullable Input to be converted to an INullableString if it is a valid string\r\n * @param propertyName The name of the property that the caller will assign the output to. Used for debugging.\r\n */\r\nexport function toRpcString(nullable: string | undefined, propertyName: string): string {\r\n    if (typeof nullable === 'string') {\r\n        return nullable;\r\n    }\r\n\r\n    if (nullable != null) {\r\n        throw new AzFuncSystemError(\r\n            `A 'string' type was expected instead of a '${typeof nullable}' type. Cannot parse value of '${propertyName}'.`\r\n        );\r\n    }\r\n\r\n    return '';\r\n}\r\n\r\n/**\r\n * Converts string input to an 'INullableString' to be sent through the RPC layer.\r\n * Input that is not a string but is also not null or undefined logs a function app level warning.\r\n * @param nullable Input to be converted to an INullableString if it is a valid string\r\n * @param propertyName The name of the property that the caller will assign the output to. Used for debugging.\r\n */\r\nexport function toNullableString(nullable: string | undefined, propertyName: string): undefined | RpcNullableString {\r\n    if (typeof nullable === 'string') {\r\n        return <RpcNullableString>{\r\n            value: nullable,\r\n        };\r\n    }\r\n\r\n    if (nullable != null) {\r\n        throw new AzFuncSystemError(\r\n            `A 'string' type was expected instead of a '${typeof nullable}' type. Cannot parse value of '${propertyName}'.`\r\n        );\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Converts Date or number input to an 'INullableTimestamp' to be sent through the RPC layer.\r\n * Input that is not a Date or number but is also not null or undefined logs a function app level warning.\r\n * @param nullable Input to be converted to an INullableTimestamp if it is valid input\r\n * @param propertyName The name of the property that the caller will assign the output to. Used for debugging.\r\n */\r\nexport function toNullableTimestamp(\r\n    dateTime: Date | number | undefined,\r\n    propertyName: string\r\n): RpcNullableTimestamp | undefined {\r\n    if (dateTime != null) {\r\n        try {\r\n            const timeInMilliseconds = typeof dateTime === 'number' ? dateTime : dateTime.getTime();\r\n\r\n            if (timeInMilliseconds && timeInMilliseconds >= 0) {\r\n                return {\r\n                    value: {\r\n                        seconds: Math.round(timeInMilliseconds / 1000),\r\n                    },\r\n                };\r\n            }\r\n        } catch {\r\n            throw new AzFuncSystemError(\r\n                `A 'number' or 'Date' input was expected instead of a '${typeof dateTime}'. Cannot parse value of '${propertyName}'.`\r\n            );\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { Cookie, HttpResponse } from '@azure/functions';\r\nimport {\r\n    RpcHttpCookie,\r\n    RpcHttpCookieSameSite,\r\n    RpcHttpData,\r\n    RpcNullableString,\r\n    RpcTypedData,\r\n} from '@azure/functions-core';\r\nimport { Dict } from '../Context';\r\nimport { AzFuncSystemError } from '../errors';\r\nimport {\r\n    fromTypedData,\r\n    toNullableBool,\r\n    toNullableDouble,\r\n    toNullableString,\r\n    toNullableTimestamp,\r\n    toRpcString,\r\n    toTypedData,\r\n} from './RpcConverters';\r\n\r\n/**\r\n * Converts the provided body from the RPC layer to the appropriate javascript object.\r\n * Body of type 'byte' is a special case and it's converted to it's utf-8 string representation.\r\n * This is to avoid breaking changes in v2.\r\n * @param body The body from the RPC layer.\r\n */\r\nexport function fromRpcHttpBody(body: RpcTypedData | null | undefined) {\r\n    if (body && body.bytes) {\r\n        return (<Buffer>body.bytes).toString();\r\n    } else {\r\n        return fromTypedData(body, false);\r\n    }\r\n}\r\n\r\nexport function fromNullableMapping(\r\n    nullableMapping: { [k: string]: RpcNullableString } | null | undefined,\r\n    originalMapping?: { [k: string]: string } | null\r\n): Dict<string> {\r\n    let converted = {};\r\n    if (nullableMapping && Object.keys(nullableMapping).length > 0) {\r\n        for (const key in nullableMapping) {\r\n            converted[key] = nullableMapping[key].value || '';\r\n        }\r\n    } else if (originalMapping && Object.keys(originalMapping).length > 0) {\r\n        converted = <Dict<string>>originalMapping;\r\n    }\r\n    return converted;\r\n}\r\n\r\n/**\r\n * Converts the HTTP 'Response' object to an 'ITypedData' 'http' type to be sent through the RPC layer.\r\n * 'http' types are a special case from other 'ITypedData' types, which come from primitive types.\r\n * @param inputMessage  An HTTP response object\r\n */\r\nexport function toRpcHttp(data: unknown): RpcTypedData {\r\n    // Check if we will fail to find any of these\r\n    if (typeof data !== 'object' || Array.isArray(data)) {\r\n        throw new AzFuncSystemError(\r\n            \"The HTTP response must be an 'object' type that can include properties such as 'body', 'status', and 'headers'. Learn more: https://go.microsoft.com/fwlink/?linkid=2112563\"\r\n        );\r\n    }\r\n\r\n    const inputMessage: HttpResponse = data || {};\r\n    let status = inputMessage.statusCode;\r\n    if (typeof inputMessage.status !== 'function') {\r\n        status ||= inputMessage.status;\r\n    }\r\n    const httpMessage: RpcHttpData = {\r\n        ...inputMessage,\r\n        statusCode: status?.toString() || null,\r\n        headers: toRpcHttpHeaders(inputMessage.headers),\r\n        cookies: toRpcHttpCookieList(inputMessage.cookies || []),\r\n        body: toTypedData(inputMessage.body),\r\n    };\r\n\r\n    return { http: httpMessage };\r\n}\r\n\r\n/**\r\n * Convert HTTP headers to a string/string mapping.\r\n * @param inputHeaders\r\n */\r\nfunction toRpcHttpHeaders(inputHeaders: RpcTypedData | undefined) {\r\n    const rpcHttpHeaders: { [key: string]: string } = {};\r\n    if (inputHeaders) {\r\n        for (const key in inputHeaders) {\r\n            if (inputHeaders[key] != null) {\r\n                rpcHttpHeaders[key] = inputHeaders[key].toString();\r\n            }\r\n        }\r\n    }\r\n    return rpcHttpHeaders;\r\n}\r\n\r\n/**\r\n * Convert HTTP 'Cookie' array to an array of 'RpcHttpCookie' objects to be sent through the RPC layer\r\n * @param inputCookies array of 'Cookie' objects representing options for the 'Set-Cookie' response header\r\n */\r\nexport function toRpcHttpCookieList(inputCookies: Cookie[]): RpcHttpCookie[] {\r\n    const rpcCookies: RpcHttpCookie[] = [];\r\n    inputCookies.forEach((cookie) => {\r\n        rpcCookies.push(toRpcHttpCookie(cookie));\r\n    });\r\n\r\n    return rpcCookies;\r\n}\r\n\r\n/**\r\n * From RFC specifications for 'Set-Cookie' response header: https://www.rfc-editor.org/rfc/rfc6265.txt\r\n * @param inputCookie\r\n */\r\nfunction toRpcHttpCookie(inputCookie: Cookie): RpcHttpCookie {\r\n    // Resolve RpcHttpCookie.SameSite enum, a one-off\r\n    let rpcSameSite: RpcHttpCookieSameSite = 'none';\r\n    if (inputCookie && inputCookie.sameSite) {\r\n        const sameSite = inputCookie.sameSite.toLocaleLowerCase();\r\n        if (sameSite === 'lax') {\r\n            rpcSameSite = 'lax';\r\n        } else if (sameSite === 'strict') {\r\n            rpcSameSite = 'strict';\r\n        } else if (sameSite === 'none') {\r\n            rpcSameSite = 'explicitNone';\r\n        }\r\n    }\r\n\r\n    const rpcCookie: RpcHttpCookie = {\r\n        name: inputCookie && toRpcString(inputCookie.name, 'cookie.name'),\r\n        value: inputCookie && toRpcString(inputCookie.value, 'cookie.value'),\r\n        domain: toNullableString(inputCookie && inputCookie.domain, 'cookie.domain'),\r\n        path: toNullableString(inputCookie && inputCookie.path, 'cookie.path'),\r\n        expires: toNullableTimestamp(inputCookie && inputCookie.expires, 'cookie.expires'),\r\n        secure: toNullableBool(inputCookie && inputCookie.secure, 'cookie.secure'),\r\n        httpOnly: toNullableBool(inputCookie && inputCookie.httpOnly, 'cookie.httpOnly'),\r\n        sameSite: rpcSameSite,\r\n        maxAge: toNullableDouble(inputCookie && inputCookie.maxAge, 'cookie.maxAge'),\r\n    };\r\n\r\n    return rpcCookie;\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nexport interface AzFuncError {\r\n    /**\r\n     * System errors can be tracked in our telemetry\r\n     * User errors cannot be tracked in our telemetry because they could have user information (users can still track it themselves in their app insights resource)\r\n     */\r\n    isAzureFunctionsSystemError: boolean;\r\n}\r\n\r\nexport class AzFuncSystemError extends Error {\r\n    isAzureFunctionsSystemError = true;\r\n}\r\n\r\nexport class AzFuncTypeError extends TypeError implements AzFuncError {\r\n    isAzureFunctionsSystemError = true;\r\n}\r\n\r\nexport class AzFuncRangeError extends RangeError implements AzFuncError {\r\n    isAzureFunctionsSystemError = true;\r\n}\r\n\r\nexport class ReadOnlyError extends AzFuncTypeError {\r\n    constructor(propertyName: string) {\r\n        super(`Cannot assign to read only property '${propertyName}'`);\r\n    }\r\n}\r\n\r\nexport function ensureErrorType(err: unknown): Error & Partial<AzFuncError> {\r\n    if (err instanceof Error) {\r\n        return err;\r\n    } else {\r\n        let message: string;\r\n        if (err === undefined || err === null) {\r\n            message = 'Unknown error';\r\n        } else if (typeof err === 'string') {\r\n            message = err;\r\n        } else if (typeof err === 'object') {\r\n            message = JSON.stringify(err);\r\n        } else {\r\n            message = String(err);\r\n        }\r\n        return new Error(message);\r\n    }\r\n}\r\n\r\n/**\r\n * This is mostly for callbacks where `null` or `undefined` indicates there is no error\r\n * By contrast, anything thrown/caught is assumed to be an error regardless of what it is\r\n */\r\nexport function isError(err: unknown): boolean {\r\n    return err !== null && err !== undefined;\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport {\r\n    Form,\r\n    HttpMethod,\r\n    HttpRequest,\r\n    HttpRequestHeaders,\r\n    HttpRequestParams,\r\n    HttpRequestQuery,\r\n    HttpRequestUser,\r\n} from '@azure/functions';\r\nimport { RpcHttpData, RpcTypedData } from '@azure/functions-core';\r\nimport { decode } from 'iconv-lite';\r\nimport { HeaderName, MediaType } from '../constants';\r\nimport { fromTypedData } from '../converters/RpcConverters';\r\nimport { fromNullableMapping, fromRpcHttpBody } from '../converters/RpcHttpConverters';\r\nimport { AzFuncSystemError } from '../errors';\r\nimport { parseForm } from '../parsers/parseForm';\r\nimport { extractHttpUserFromHeaders } from './extractHttpUserFromHeaders';\r\n\r\nexport class Request implements HttpRequest {\r\n    method: HttpMethod | null;\r\n    url: string;\r\n    originalUrl: string;\r\n    headers: HttpRequestHeaders;\r\n    query: HttpRequestQuery;\r\n    params: HttpRequestParams;\r\n    body?: any;\r\n    rawBody?: any;\r\n    bufferBody?: Buffer;\r\n\r\n    #cachedUser?: HttpRequestUser | null;\r\n\r\n    constructor(rpcHttp: RpcHttpData) {\r\n        this.method = <HttpMethod>rpcHttp.method;\r\n        this.url = <string>rpcHttp.url;\r\n        this.originalUrl = <string>rpcHttp.url;\r\n        this.headers = fromNullableMapping(rpcHttp.nullableHeaders, rpcHttp.headers);\r\n        this.query = fromNullableMapping(rpcHttp.nullableQuery, rpcHttp.query);\r\n        this.params = fromNullableMapping(rpcHttp.nullableParams, rpcHttp.params);\r\n\r\n        if (rpcHttp.body?.bytes) {\r\n            this.bufferBody = Buffer.from(rpcHttp.body.bytes);\r\n            // We turned on the worker capability to always receive bytes instead of a string (RawHttpBodyBytes) so that we could introduce the `bufferBody` property\r\n            // However, we need to replicate the old host behavior for the `body` and `rawBody` properties so that we don't break anyone\r\n            // https://github.com/Azure/azure-functions-nodejs-worker/issues/294\r\n            // NOTE: The tests for this are in the e2e test folder of the worker. This is so we can test the full .net host behavior of encoding/parsing/etc.\r\n            // https://github.com/Azure/azure-functions-nodejs-worker/blob/b109082f9b85b42af1de00db4192483460214d81/test/end-to-end/Azure.Functions.NodejsWorker.E2E/Azure.Functions.NodejsWorker.E2E/HttpEndToEndTests.cs\r\n\r\n            const contentType = this.get(HeaderName.contentType)?.toLowerCase();\r\n            let legacyBody: RpcTypedData | undefined | null;\r\n            if (contentType === MediaType.octetStream || contentType?.startsWith(MediaType.multipartPrefix)) {\r\n                // If the content type was octet or multipart, the host would leave the body as bytes\r\n                // https://github.com/Azure/azure-functions-host/blob/9ac904e34b744d95a6f746921556235d4b2b3f0f/src/WebJobs.Script.Grpc/MessageExtensions/GrpcMessageConversionExtensions.cs#L233\r\n                legacyBody = rpcHttp.body;\r\n            } else {\r\n                // Otherwise the host would decode the buffer to a string\r\n                legacyBody = {\r\n                    string: decodeBuffer(this.bufferBody),\r\n                };\r\n            }\r\n\r\n            this.body = fromTypedData(legacyBody);\r\n            this.rawBody = fromRpcHttpBody(legacyBody);\r\n        }\r\n    }\r\n\r\n    get user(): HttpRequestUser | null {\r\n        if (this.#cachedUser === undefined) {\r\n            this.#cachedUser = extractHttpUserFromHeaders(this.headers);\r\n        }\r\n\r\n        return this.#cachedUser;\r\n    }\r\n\r\n    get(field: string): string | undefined {\r\n        return this.headers && this.headers[field.toLowerCase()];\r\n    }\r\n\r\n    parseFormBody(): Form {\r\n        const contentType = this.get(HeaderName.contentType);\r\n        if (!contentType) {\r\n            throw new AzFuncSystemError(`\"${HeaderName.contentType}\" header must be defined.`);\r\n        } else {\r\n            return parseForm(this.body, contentType);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * The host used utf8 by default, but supported `detectEncodingFromByteOrderMarks` so we have to replicate that\r\n * Host code: https://github.com/Azure/azure-webjobs-sdk-extensions/blob/03cb2ce82db74ed5a2f3299e8a84a6c35835c269/src/WebJobs.Extensions.Http/Extensions/HttpRequestExtensions.cs#L27\r\n * .NET code: https://github.com/dotnet/runtime/blob/e55c908229e36f99a52745d4ee85316a0e8bb6a2/src/libraries/System.Private.CoreLib/src/System/IO/StreamReader.cs#L469\r\n * .NET description of encoding preambles: https://docs.microsoft.com/en-us/dotnet/api/system.text.encoding.getpreamble?view=net-6.0#remarks\r\n **/\r\nfunction decodeBuffer(buffer: Buffer): string | undefined {\r\n    let encoding = 'utf8';\r\n    if (buffer[0] === 0xfe && buffer[1] === 0xff) {\r\n        encoding = 'utf16be'; // The same as `Encoding.BigEndianUnicode` in .NET\r\n        buffer = compressBuffer(buffer, 2);\r\n    } else if (buffer[0] === 0xff && buffer[1] === 0xfe) {\r\n        if (buffer[2] !== 0 || buffer[3] !== 0) {\r\n            encoding = 'utf16le'; // The same as `Encoding.Unicode` in .NET\r\n            buffer = compressBuffer(buffer, 2);\r\n        } else {\r\n            encoding = 'utf32le';\r\n            buffer = compressBuffer(buffer, 4);\r\n        }\r\n    } else if (buffer[0] === 0xef && buffer[1] === 0xbb && buffer[2] === 0xbf) {\r\n        encoding = 'utf8';\r\n        buffer = compressBuffer(buffer, 3);\r\n    } else if (buffer[0] === 0 && buffer[1] === 0 && buffer[2] === 0xfe && buffer[3] === 0xff) {\r\n        encoding = 'utf32be';\r\n        buffer = compressBuffer(buffer, 4);\r\n    }\r\n\r\n    // NOTE: Node.js doesn't support all the above encodings by default, so we have to use \"iconv-lite\" to help\r\n    // Here are the iconv-lite supported encodings: https://github.com/ashtuchkin/iconv-lite/wiki/Supported-Encodings\r\n    return decode(buffer, encoding);\r\n}\r\n\r\nfunction compressBuffer(buffer: Buffer, n: number): Buffer {\r\n    return buffer.subarray(n);\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { Cookie, HttpResponseFull } from '@azure/functions';\r\nimport { HeaderName, MediaType } from '../constants';\r\n\r\nexport class Response implements HttpResponseFull {\r\n    statusCode?: string | number;\r\n    headers: { [key: string]: any } = {};\r\n    cookies: Cookie[] = [];\r\n    body?: any;\r\n    enableContentNegotiation?: boolean;\r\n    [key: string]: any;\r\n\r\n    // NOTE: This is considered private and people should not be referencing it, but for the sake of backwards compatibility we will avoid using `#`\r\n    _done: Function;\r\n\r\n    constructor(done: Function) {\r\n        this._done = done;\r\n    }\r\n\r\n    end(body?: any) {\r\n        if (body !== undefined) {\r\n            this.body = body;\r\n        }\r\n        this.setContentType();\r\n        this._done();\r\n        return this;\r\n    }\r\n\r\n    setHeader(field: string, val: any): HttpResponseFull {\r\n        this.headers[field.toLowerCase()] = val;\r\n        return this;\r\n    }\r\n\r\n    getHeader(field: string): any {\r\n        return this.headers[field.toLowerCase()];\r\n    }\r\n\r\n    removeHeader(field: string) {\r\n        delete this.headers[field.toLowerCase()];\r\n        return this;\r\n    }\r\n\r\n    status(statusCode: string | number): HttpResponseFull {\r\n        this.statusCode = statusCode;\r\n        return this;\r\n    }\r\n\r\n    sendStatus(statusCode: string | number) {\r\n        this.status(statusCode);\r\n        // eslint-disable-next-line deprecation/deprecation\r\n        return this.end();\r\n    }\r\n\r\n    type(type) {\r\n        return this.set(HeaderName.contentType, type);\r\n    }\r\n\r\n    json(body) {\r\n        this.type(MediaType.json);\r\n        // eslint-disable-next-line deprecation/deprecation\r\n        this.send(body);\r\n        return;\r\n    }\r\n\r\n    send = this.end;\r\n    header = this.setHeader;\r\n    set = this.setHeader;\r\n    get = this.getHeader;\r\n\r\n    // NOTE: This is considered private and people should not be referencing it, but for the sake of backwards compatibility we will avoid using `#`\r\n    setContentType() {\r\n        if (this.body !== undefined) {\r\n            if (this.get(HeaderName.contentType)) {\r\n                // use user defined content type, if exists\r\n                return;\r\n            }\r\n\r\n            if (Buffer.isBuffer(this.body)) {\r\n                this.type(MediaType.octetStream);\r\n            }\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { HttpRequestHeaders, HttpRequestUser } from '@azure/functions';\r\n\r\nexport function extractHttpUserFromHeaders(headers: HttpRequestHeaders): HttpRequestUser | null {\r\n    let user: HttpRequestUser | null = null;\r\n\r\n    if (headers['x-ms-client-principal']) {\r\n        const claimsPrincipalData = JSON.parse(\r\n            Buffer.from(headers['x-ms-client-principal'], 'base64').toString('utf-8')\r\n        );\r\n\r\n        if (claimsPrincipalData['identityProvider']) {\r\n            user = {\r\n                type: 'StaticWebApps',\r\n                id: claimsPrincipalData['userId'],\r\n                username: claimsPrincipalData['userDetails'],\r\n                identityProvider: claimsPrincipalData['identityProvider'],\r\n                claimsPrincipalData,\r\n            };\r\n        } else {\r\n            user = {\r\n                type: 'AppService',\r\n                id: headers['x-ms-client-principal-id'],\r\n                username: headers['x-ms-client-principal-name'],\r\n                identityProvider: headers['x-ms-client-principal-idp'],\r\n                claimsPrincipalData,\r\n            };\r\n        }\r\n    }\r\n\r\n    return user;\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport * as types from '@azure/functions';\r\nimport { MediaType } from '../constants';\r\nimport { AzFuncSystemError } from '../errors';\r\nimport { parseContentType } from './parseHeader';\r\nimport { parseMultipartForm } from './parseMultipartForm';\r\n\r\n/**\r\n * See ./test/parseForm.test.ts for examples\r\n */\r\nexport function parseForm(data: Buffer | string, contentType: string): Form {\r\n    const [mediaType, parameters] = parseContentType(contentType);\r\n    switch (mediaType.toLowerCase()) {\r\n        case MediaType.multipartForm: {\r\n            const boundary = parameters.get('boundary');\r\n            const parts = parseMultipartForm(typeof data === 'string' ? Buffer.from(data) : data, boundary);\r\n            return new Form(parts);\r\n        }\r\n        case MediaType.urlEncodedForm: {\r\n            const parsed = new URLSearchParams(data.toString());\r\n            const parts: [string, types.FormPart][] = [];\r\n            for (const [key, value] of parsed) {\r\n                parts.push([key, { value: Buffer.from(value) }]);\r\n            }\r\n            return new Form(parts);\r\n        }\r\n        default:\r\n            throw new AzFuncSystemError(\r\n                `Media type \"${mediaType}\" does not match types supported for form parsing: \"${MediaType.multipartForm}\", \"${MediaType.urlEncodedForm}\".`\r\n            );\r\n    }\r\n}\r\n\r\nexport class Form implements types.Form {\r\n    #parts: [string, types.FormPart][];\r\n    constructor(parts: [string, types.FormPart][]) {\r\n        this.#parts = parts;\r\n    }\r\n\r\n    get(name: string): types.FormPart | null {\r\n        for (const [key, value] of this.#parts) {\r\n            if (key === name) {\r\n                return value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getAll(name: string): types.FormPart[] {\r\n        const result: types.FormPart[] = [];\r\n        for (const [key, value] of this.#parts) {\r\n            if (key === name) {\r\n                result.push(value);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        for (const [key] of this.#parts) {\r\n            if (key === name) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    [Symbol.iterator](): Iterator<[string, types.FormPart]> {\r\n        return this.#parts[Symbol.iterator]();\r\n    }\r\n\r\n    get length(): number {\r\n        return this.#parts.length;\r\n    }\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { HeaderName } from '../constants';\r\nimport { AzFuncSystemError } from '../errors';\r\n\r\nconst space = ' ';\r\n// See \"LEXICAL TOKENS\" section for definition of ctl chars and quoted string: https://www.w3.org/Protocols/rfc822/3_Lexical.html\r\nconst ctlChars = '\\\\u0000-\\\\u001F\\\\u007F';\r\nconst quotedString = '(?:[^\"\\\\\\\\]|\\\\\\\\.)*';\r\n// General description of content type header, including defintion of tspecials and token https://www.w3.org/Protocols/rfc1341/4_Content-Type.html\r\nconst tspecials = '\\\\(\\\\)<>@,;:\\\\\\\\\"\\\\/\\\\[\\\\]\\\\?\\\\.=';\r\nconst token = `[^${space}${ctlChars}${tspecials}]+`;\r\n\r\nconst start = '^\\\\s*'; // allows leading whitespace\r\nconst end = '\\\\s*(.*)$'; // gets the rest of the string except leading whitespace\r\nconst semicolonEnd = `\\\\s*;?${end}`; // allows optional semicolon and otherwise gets the rest of the string\r\n\r\n/**\r\n * @param data a full header, e.g. \"Content-Type: text/html; charset=UTF-8\"\r\n * @param headerName the header name, e.g. \"Content-Type\"\r\n * @returns the header value, e.g. \"text/html; charset=UTF-8\" or null if not found\r\n */\r\nexport function getHeaderValue(data: string, headerName: string): string | null {\r\n    const match = new RegExp(`${start}${headerName}\\\\s*:${end}`, 'i').exec(data);\r\n    if (match) {\r\n        return match[1].trim();\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * @param data a content type, e.g. \"text/html; charset=UTF-8\"\r\n * @returns an array containing the media type (e.g. text/html) and an object with the parameters\r\n */\r\nexport function parseContentType(data: string): [string, HeaderParams] {\r\n    const match = new RegExp(`${start}(${token}\\\\/${token})${semicolonEnd}`, 'i').exec(data);\r\n    if (!match) {\r\n        throw new AzFuncSystemError(`${HeaderName.contentType} must begin with format \"type/subtype\".`);\r\n    } else {\r\n        return [match[1], parseHeaderParams(match[2])];\r\n    }\r\n}\r\n\r\n/**\r\n * @param data a content disposition, e.g. \"form-data; name=myfile; filename=test.txt\"\r\n * @returns an array containing the disposition (e.g. form-data) and an object with the parameters\r\n */\r\nexport function parseContentDisposition(data: string): [string, HeaderParams] {\r\n    const match = new RegExp(`${start}(${token})${semicolonEnd}`, 'i').exec(data);\r\n    if (!match) {\r\n        throw new AzFuncSystemError(`${HeaderName.contentDisposition} must begin with disposition type.`);\r\n    } else {\r\n        return [match[1], parseHeaderParams(match[2])];\r\n    }\r\n}\r\n\r\nfunction parseHeaderParams(data: string): HeaderParams {\r\n    const result = new HeaderParams();\r\n    while (data) {\r\n        // try to find an unquoted name=value pair first\r\n        const regexp = new RegExp(`${start}(${token})=(${token})${semicolonEnd}`, 'i');\r\n        let match = regexp.exec(data);\r\n        // if that didn't work, try to find a quoted name=\"value\" pair instead\r\n        if (!match) {\r\n            const quotedPartsRegexp = new RegExp(`${start}(${token})=\"(${quotedString})\"${semicolonEnd}`, 'i');\r\n            match = quotedPartsRegexp.exec(data);\r\n        }\r\n\r\n        if (match) {\r\n            result.add(match[1], match[2].replace(/\\\\\"/g, '\"')); // un-escape any quotes\r\n            data = match[3];\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nexport class HeaderParams {\r\n    #params: { [name: string]: string } = {};\r\n    get(name: string): string {\r\n        const result = this.#params[name.toLowerCase()];\r\n        if (result === undefined) {\r\n            throw new AzFuncSystemError(`Failed to find parameter with name \"${name}\".`);\r\n        } else {\r\n            return result;\r\n        }\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        return this.#params[name.toLowerCase()] !== undefined;\r\n    }\r\n\r\n    add(name: string, value: string): void {\r\n        this.#params[name.toLowerCase()] = value;\r\n    }\r\n}\r\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { FormPart } from '@azure/functions';\r\nimport { HeaderName } from '../constants';\r\nimport { AzFuncSystemError } from '../errors';\r\nimport { getHeaderValue, parseContentDisposition } from './parseHeader';\r\n\r\nconst carriageReturn = Buffer.from('\\r')[0];\r\nconst newline = Buffer.from('\\n')[0];\r\n\r\n// multipart/form-data specification https://datatracker.ietf.org/doc/html/rfc7578\r\nexport function parseMultipartForm(chunk: Buffer, boundary: string): [string, FormPart][] {\r\n    const result: [string, FormPart][] = [];\r\n    let currentName: string | undefined;\r\n    let currentPart: FormPart | undefined;\r\n    let inHeaders = false;\r\n\r\n    const boundaryBuffer = Buffer.from(`--${boundary}`);\r\n    const endBoundaryBuffer = Buffer.from(`--${boundary}--`);\r\n\r\n    let lineStart = 0;\r\n    let lineEnd = 0;\r\n    let partValueStart = 0;\r\n    let partValueEnd = 0;\r\n\r\n    for (let index = 0; index < chunk.length; index++) {\r\n        let line: Buffer;\r\n        if (chunk[index] === newline) {\r\n            lineEnd = chunk[index - 1] === carriageReturn ? index - 1 : index;\r\n            line = chunk.slice(lineStart, lineEnd);\r\n            lineStart = index + 1;\r\n        } else {\r\n            continue;\r\n        }\r\n\r\n        const isBoundary = line.equals(boundaryBuffer);\r\n        const isBoundaryEnd = line.equals(endBoundaryBuffer);\r\n        if (isBoundary || isBoundaryEnd) {\r\n            if (currentPart) {\r\n                currentPart.value = chunk.slice(partValueStart, partValueEnd);\r\n            }\r\n\r\n            if (isBoundaryEnd) {\r\n                break;\r\n            }\r\n\r\n            currentPart = {\r\n                value: Buffer.from(''),\r\n            };\r\n            inHeaders = true;\r\n        } else if (inHeaders) {\r\n            if (!currentPart) {\r\n                throw new AzFuncSystemError(`Expected form data to start with boundary \"${boundary}\".`);\r\n            }\r\n\r\n            const lineAsString = line.toString();\r\n            if (!lineAsString) {\r\n                // A blank line means we're done with the headers for this part\r\n                inHeaders = false;\r\n                if (!currentName) {\r\n                    throw new AzFuncSystemError(\r\n                        `Expected part to have header \"${HeaderName.contentDisposition}\" with parameter \"name\".`\r\n                    );\r\n                } else {\r\n                    partValueStart = lineStart;\r\n                    partValueEnd = lineStart;\r\n                    result.push([currentName, currentPart]);\r\n                }\r\n            } else {\r\n                const contentDisposition = getHeaderValue(lineAsString, HeaderName.contentDisposition);\r\n                if (contentDisposition) {\r\n                    const [, dispositionParts] = parseContentDisposition(contentDisposition);\r\n                    currentName = dispositionParts.get('name');\r\n\r\n                    // filename is optional, even for files\r\n                    if (dispositionParts.has('fileName')) {\r\n                        currentPart.fileName = dispositionParts.get('fileName');\r\n                    }\r\n                } else {\r\n                    const contentType = getHeaderValue(lineAsString, HeaderName.contentType);\r\n                    if (contentType) {\r\n                        currentPart.contentType = contentType;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            partValueEnd = lineEnd;\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n","module.exports = require(\"@azure/functions-core\");","module.exports = require(\"events\");","module.exports = require(\"iconv-lite\");","module.exports = require(\"long\");","module.exports = require(\"util\");","module.exports = require(\"uuid\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport * as coreTypes from '@azure/functions-core';\r\nimport { CoreInvocationContext, setProgrammingModel } from '@azure/functions-core';\r\nimport { version } from './constants';\r\nimport { InvocationModel } from './InvocationModel';\r\n\r\nclass ProgrammingModel implements coreTypes.ProgrammingModel {\r\n    name = '@azure/functions';\r\n    version = version;\r\n    getInvocationModel(coreCtx: CoreInvocationContext): InvocationModel {\r\n        return new InvocationModel(coreCtx);\r\n    }\r\n}\r\n\r\nexport function setup() {\r\n    setProgrammingModel(new ProgrammingModel());\r\n}\r\n"],"names":[],"sourceRoot":""}